!function(){function e(e,n){function t(){var e=r+", "+l+"%, "+u+"%",n="hsl("+e+")",t="hsla("+e+", 0)",a="url(images/color-background.svg)",c="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";o.style.backgroundImage="linear-gradient("+c+"), linear-gradient(90deg, "+t+", "+n+"), "+a,i.style.backgroundImage="linear-gradient(90deg, "+c+"), linear-gradient("+n+", "+t+"), "+a}var a="AlphaSlider",o=c(a+"-portraitBar"),i=c(a+"-landscapeBar"),r=0,l=0,u=0,d=D(function(n){e(n),t()},n);return d.setRatio(1),d.addClass(a),d.barElement.appendChild(o),d.barElement.appendChild(i),t(),{abortTouch:d.abortTouch,element:d.element,setAlpha:d.setRatio,setHue:function(e){r=e,t()},setLuminance:function(e){u=e,t()},setSaturation:function(e){l=e,t()}}}function n(e,n){function t(){s.addEventListener("mousedown",i),s.addEventListener("touchstart",l)}function o(){n(),m.add("active"),clearTimeout(h),h=setTimeout(function(){m.remove("active")},100)}function i(e){0===e.button&&(e.preventDefault(),u?u=!1:o())}function r(e){d.style.backgroundImage="url(images/"+e+".svg)"}function l(e){u=!0,e.preventDefault(),o()}var u=!1,d=c("Button-content"),s=c("Button");s.appendChild(d);var h,v=a(s),f=!1,m=s.classList;return r(e),t(),{contentElement:d,element:s,hideExpandable:v.hide,setIcon:r,showExpandable:v.show,addClass:function(e){m.add(e)},check:function(){m.add("checked"),f=!0},disable:function(){m.add("disabled"),s.removeEventListener("mousedown",i),s.removeEventListener("touchstart",l)},enable:function(){m.remove("disabled"),t()},isChecked:function(){return f},uncheck:function(){m.remove("checked"),f=!1}}}function t(e){function n(n){var s=d.getBoundingClientRect(),h=Math.floor(n.clientX-s.left),v=Math.floor(n.clientY-s.top),f=d.getContext("2d"),m=f.getImageData(h,v,1,1),p=m.data,g=p[0],C=p[1],b=p[2];!function(n,r,c,l){var u=1-l,s=n*l,f=r*l,m=c*l;e.operate(function(e){function l(e,n){if(!(i>e||e==a||t>n||n==o)){if(B[n]){if(B[n][e])return}else B[n]=Object.create(null);B[n][e]=!0,w.push([e,n])}}var p=d.width,E=d.height,k=e.getImageData(0,0,p,E),L=k.data,w=[],B=Object.create(null);l(h,v);for(var y=Object.create(null),x=20;w.length;){var T=w.shift(),S=T[0],D=T[1],M=4*(D*p+S),I=M+1,P=I+1,z=L[M],R=L[I],H=L[P],A=Math.abs(g-z),N=Math.abs(C-R),W=Math.abs(b-H),X=Math.max(A,N,W);X>x?(y[D]||(y[D]=Object.create(null)),y[D][S]=!0):(L[M]=s+z*u,L[I]=f+R*u,L[P]=m+H*u,l(S+1,D),l(S-1,D),l(S,D+1),l(S,D-1))}for(var Y in y){var U=y[Y];for(var O in U){var M=4*(Y*p+Number(O)),I=M+1,P=I+1,z=L[M],R=L[I],H=L[P];L[M]=((z+n)/2+s+z*u)/2,L[I]=((R+r)/2+f+R*u)/2,L[P]=((H+c)/2+m+z*u)/2}}e.putImageData(k,0,0)},200)}(r,c,l,u)}var t,a,o,i,r=0,c=0,l=0,u=1,d=e.canvas,s=!1;return{disable:function(){s&&(d.removeEventListener("mousedown",n),s=!1)},enable:function(){s||(d.addEventListener("mousedown",n),s=!0)},setColor:function(e,n,t,a){var o=h(e,n,t);r=o.r,c=o.g,l=o.b,u=a},resize:function(e,n){var r=d.width/2,c=d.height/2,l=e/2,u=n/2;t=Math.floor(c-u),a=Math.floor(r+l),o=Math.ceil(c+u),i=Math.ceil(r-l)}}}function a(e){var n=c("ButtonExpandable-top");n.style.backgroundImage="url(images/top-expandable.svg)";var t=c("ButtonExpandable-left");t.style.backgroundImage="url(images/left-expandable.svg)";var a=!1;return{hide:function(){a!==!1&&(a=!1,e.removeChild(n),e.removeChild(t))},show:function(){a!==!0&&(a=!0,e.appendChild(n),e.appendChild(t))}}}function o(){var e="Canvas",n=Math.max(screen.width,screen.height),t=document.createElement("canvas");t.className=e+"-canvas",t.width=t.height=n,t.style.left=t.style.top=-n/2+"px";var a=t.getContext("2d");a.lineCap="round",a.fillStyle="#fff",a.fillRect(0,0,n,n);var o=c(e+"-center");o.appendChild(t);var i=c(e);i.appendChild(o);var r=document.createElement("canvas");r.width=r.height=n;var l=r.getContext("2d");l.lineCap="round",l.fillStyle="#fff",l.fillRect(0,0,n,n);var u,d,s=[],h=128,v=[];return{canvas:t,element:i,onUndoAvailable:function(e){u=e},onUndoUnavailable:function(e){d=e},operate:function(e,t){s.push({operation:e,timeout:t}),1==s.length&&u(),e(a);var o=s.length-h;if(!(0>o)){var i=Math.floor(o/h);if(!v[i]){var c=document.createElement("canvas");c.width=c.height=n;var d=c.getContext("2d");d.lineCap="round",i?d.drawImage(v[i-1],0,0):d.drawImage(r,0,0),v.push(c);for(var f=o;o+h>f;f++)s[f].operation(d);v.length>16&&(l.drawImage(v.shift(),0,0),s.splice(0,h))}}},undo:function(){if(a.globalAlpha=1,v.length?a.drawImage(v[v.length-1],0,0):a.drawImage(r,0,0),!s.length)return 50;for(var e=s.pop(),n=v.length*h,t=n;t<s.length;t++)s[t].operation(a);return v.length*h>s.length&&v.pop(),s.length||d(),e.timeout}}}function i(e){function n(){e(),v.add("active"),clearTimeout(d),d=setTimeout(function(){v.remove("active")},100)}var t=!1,o="ColorButton",i=c(o+"-opaque"),r=c(o+"-color");r.appendChild(i);var l=c(o+"-transparency Button-content");l.appendChild(r),l.style.backgroundImage="url(images/color-background.svg)";var u=c("Button");u.appendChild(l),u.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),t?t=!1:n())}),u.addEventListener("touchstart",function(e){t=!0,e.preventDefault(),n()});var d,s=a(u),h=!1,v=u.classList,f={};return{color:f,element:u,hideExpandable:s.hide,showExpandable:s.show,addClass:function(e){v.add(e)},check:function(){v.add("checked"),h=!0},isChecked:function(){return h},mark:function(){v.add("marked")},setColor:function(e,n,t,a){f.hue=e,f.saturation=n,f.luminance=t,f.alpha=a;var o=e+", "+n+"%, "+t+"%",c="hsla("+o+", "+a+")";r.style.backgroundColor=c;var l="hsl("+o+")";i.style.backgroundColor=l},uncheck:function(){v.remove("checked"),h=!1},unmark:function(){v.remove("marked")}}}function r(e){function n(n,r,c,l){var u=i(function(){t(u),e(u)});return u.setColor(n,r,c,1),u.addClass(o+"-colorButton"),u.addClass(o+"-"+l+"Button"),a.push(u),u}function t(e){w.uncheck(),e.check(),w=e,y.setColor=e.setColor}var a=[],o="ColorButtonsPanel",r=n(0,0,0,"black");r.check(),r.mark();var l=n(0,0,40,"darkGrey"),u=n(0,0,70,"lightGrey"),d=n(0,0,100,"white");d.mark();var s=n(232,100,50,"blue"),h=n(210,100,80,"skyBlue"),v=n(114,100,33,"darkGreen"),f=n(115,87,50,"green"),m=n(4,100,47,"red"),p=n(60,100,50,"yellow"),g=n(30,100,33,"brown"),C=n(32,100,50,"orange"),b=n(306,100,33,"violet"),E=n(312,100,83,"pink"),k=n(30,55,65,"darkSkin"),L=n(31,55,75,"lightSkin"),w=r,B=c(o);B.appendChild(r.element),B.appendChild(l.element),B.appendChild(u.element),B.appendChild(d.element),B.appendChild(s.element),B.appendChild(h.element),B.appendChild(v.element),B.appendChild(f.element),B.appendChild(m.element),B.appendChild(p.element),B.appendChild(g.element),B.appendChild(C.element),B.appendChild(b.element),B.appendChild(E.element),B.appendChild(k.element),B.appendChild(L.element);var y={blackButton:r,element:B,select:t,whiteButton:d,setColor:w.setColor};return y}function c(e){var n=document.createElement("div");return n.className=e,n}function l(n){function t(){d.abortTouch(),s.abortTouch(),h.abortTouch()}function a(){n(o,i,r,l)}var o=0,i=0,r=0,l=1,u="EditColorPanel",d=v(function(e){o=e,a(),s.setHue(o),h.setHue(o),f.setHue(o)},a),s=S(function(e){i=e,a(),h.setSaturation(i),f.setSaturation(i)},a),h=m(function(e){r=e,a(),s.setLuminance(r),f.setLuminance(r)},a),f=e(function(e){l=e,a()},a),p=c(u);return p.appendChild(d.element),p.appendChild(s.element),p.appendChild(h.element),p.appendChild(f.element),{element:p,hide:function(){t(),f.abortTouch(),p.classList.remove("visible")},setColor:function(e,n,a,c){t(),o=e,i=n,r=a,l=c,d.setHue(o),s.setHue(o),s.setSaturation(i),s.setLuminance(r),h.setHue(o),h.setSaturation(i),h.setLuminance(r),f.setHue(o),f.setSaturation(i),f.setLuminance(r),f.setAlpha(l)},show:function(){p.classList.add("visible")}}}function u(e,n){function t(t){var o={};i(o,t);var r={x:o.x,y:o.y},c={color:b,endPoint:r,size:e,startPoint:o,end:function(){d.splice(d.indexOf(c),1),u(),n.operate(function(e){a(e,c)},200)},move:function(e){i(r,e),u()}};return d.push(c),u(),c}function a(e,n){var t=n.startPoint,a=t.x,o=t.y,i=n.endPoint,r=i.x,c=i.y,l=(r-a)/2,u=(c-o)/2,d=.5522848,s=l*d,h=u*d,v=a+l,f=o+u;e.beginPath(),e.moveTo(a,f),e.bezierCurveTo(a,f-h,v-s,o,v,o),e.bezierCurveTo(v+s,o,r,f-h,r,f),e.bezierCurveTo(r,f+h,v+s,c,v,c),e.bezierCurveTo(v-s,c,a,f+h,a,f),e.lineJoin="round",e.lineWidth=n.size,e.strokeStyle=n.color,e.stroke()}function o(e){function n(e){o.move(e),u()}function a(){o.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var o=t(e);addEventListener("mousemove",n),addEventListener("mouseup",a)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=a.identifier,i=h[o];i&&(i.end(),delete h[o])}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=h[a.identifier];o&&o.move(a)}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++){var o=n[a];h[o.identifier]=t(o)}}function u(){k.clearRect(0,0,E.width,E.height),d.forEach(function(e){a(k,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,m=0,p=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",E=document.createElement("canvas");E.className="EllipseTool-overlayCanvas",E.width=f.width,E.height=f.height,E.style.top=f.style.top,E.style.left=f.style.left;var k=E.getContext("2d");return f.parentNode.appendChild(E),{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",l),f.removeEventListener("touchmove",c),f.removeEventListener("touchend",r),f.removeEventListener("touchcancel",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",l),f.addEventListener("touchmove",c),f.addEventListener("touchend",r),f.addEventListener("touchcancel",r),v=!0)},setColor:function(e,n,t,a){m=e,p=n,g=t,C=a,b="hsla("+m+", "+p+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function d(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){var e=new Image;e.src=a.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},a.onabort=function(){},a.onerror=function(){},o.removeChild(e),t()}),o.appendChild(e)}var a=c("Button-content");a.style.backgroundImage="url(images/"+e+".svg)";var o=c("Button");return o.appendChild(a),t(),{element:o,addClass:function(e){o.classList.add(e)}}}function s(e,t,a){var o="FilePanel",i=n("file",e);i.addClass(o+"-newButton");var r=d("open",t);r.addClass(o+"-openButton");var l=n("save",a);l.addClass(o+"-saveButton");var u=c(o+"-content");u.appendChild(i.element),u.appendChild(r.element),u.appendChild(l.element);var s=c(o);s.appendChild(u);var h=u.classList;return{element:s,hide:function(){h.remove("visible")},show:function(){h.add("visible")}}}function h(e,n,t){var a,o,i,r,c,l;return isFinite(e)||(e=0),isFinite(n)||(n=0),isFinite(t)||(t=0),e/=60,0>e&&(e=6- -e%6),e%=6,n=Math.max(0,Math.min(1,n/100)),t=Math.max(0,Math.min(1,t/100)),c=(1-Math.abs(2*t-1))*n,l=c*(1-Math.abs(e%2-1)),1>e?(a=c,o=l,i=0):2>e?(a=l,o=c,i=0):3>e?(a=0,o=c,i=l):4>e?(a=0,o=l,i=c):5>e?(a=l,o=0,i=c):(a=c,o=0,i=l),r=t-c/2,a=Math.round(255*(a+r)),o=Math.round(255*(o+r)),i=Math.round(255*(i+r)),{r:a,g:o,b:i}}function v(e,n){var t=D(function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function f(e,n){function t(t){var o={};i(o,t);var r={x:o.x,y:o.y},c={color:b,endPoint:r,size:e,startPoint:o,end:function(){d.splice(d.indexOf(c),1),u(),n.operate(function(e){a(e,c)},200)},move:function(e){i(r,e),u()}};return d.push(c),u(),c}function a(e,n){var t=n.startPoint,a=n.endPoint;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(a.x,a.y),e.strokeStyle=n.color,e.lineCap="round",e.lineWidth=n.size,e.stroke()}function o(e){function n(e){o.move(e),u()}function a(){o.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var o=t(e);addEventListener("mousemove",n),addEventListener("mouseup",a)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=a.identifier,i=h[o];i&&(i.end(),delete h[o])}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=h[a.identifier];o&&o.move(a)}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++){var o=n[a];h[o.identifier]=t(o)}}function u(){k.clearRect(0,0,E.width,E.height),d.forEach(function(e){a(k,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,m=0,p=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",E=document.createElement("canvas");E.className="LineTool-overlayCanvas",E.width=f.width,E.height=f.height,E.style.top=f.style.top,E.style.left=f.style.left;var k=E.getContext("2d");return f.parentNode.appendChild(E),{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",l),f.removeEventListener("touchmove",c),f.removeEventListener("touchend",r),f.removeEventListener("touchcancel",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",l),f.addEventListener("touchmove",c),f.addEventListener("touchend",r),f.addEventListener("touchcancel",r),v=!0)},setColor:function(e,n,t,a){m=e,p=n,g=t,C=a,b="hsla("+m+", "+p+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function m(e,n){function t(){var e="hsl("+a+", "+o+"%, 0%)",n="hsl("+a+", "+o+"%, 50%)",t="hsl("+a+", "+o+"%, 100%)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",l.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+t+", "+n+", "+e+")"}var a=0,o=0,i="LuminanceSlider",r=c(i+"-portraitBar"),l=c(i+"-landscapeBar"),u=D(function(n){e(100*n)},n);return u.addClass(i),u.barElement.appendChild(r),u.barElement.appendChild(l),t(),{abortTouch:u.abortTouch,element:u.element,setHue:function(e){a=e,t()},setLuminance:function(e){u.setRatio(e/100)},setSaturation:function(e){o=e,t()}}}function p(e){var n="MainBar",t=c(n+"-alternativeBar");t.appendChild(e.element);var a=c(n+"-bar"),o=c(n+"-scroll");o.appendChild(a),o.appendChild(t);var i=c(n);i.appendChild(o);var r=o.classList;return{element:i,addButton:function(e){a.appendChild(e.element)},show:function(){i.classList.add("visible")},slide:function(){r.add("slide")},unslide:function(){r.remove("slide")}}}function g(){function e(){i(),r(),a(),ie()}function a(){K.hide(),ne.uncheck()}function i(){X.hide(),$.uncheck()}function r(){J.hide(),_.uncheck()}function l(){Z.uncheck(),V.disable()}function d(){Q.uncheck(),Q.hideExpandable(),G.disable()}function h(){Z.check(),V.enable()}function v(){Q.check(),Q.showExpandable(),G.enable()}function m(){W.hide(),e(),d(),h(),J.setSize(R),Z.mark(),Q.unmark(),D(Z,[V]),N=m}function g(){e(),l(),v(),J.setSize(z),Q.mark(),Z.unmark(),D(Q,[Y,U,O,F,j]),N=g}function L(e,n,t,a,o){o==Q.colorButton&&S(e,n,t,a),o==Z.colorButton&&x(e,n,t,a),J.setColor(e,n,t)}function x(e,n,t,a){V.setColor(e,n,t,a),Z.setColor(e,n,t,a)}function S(e,n,t,a){G.setColor(e,n,t,a),Q.setColor(e,n,t,a)}function D(e,n){var t=e.colorButton;X.select(t);var a=t.color,o=a.hue,i=a.saturation,r=a.luminance;n.forEach(function(e){e.setColor(o,i,r,a.alpha)}),J.setColor(o,i,r)}var z=4,R=8,H="MainPanel",A=o(),N=g,W=I(function(){Q.setIcon("pencil"),G.disable(),G=Y,G.enable(),_.enable()},function(){Q.setIcon("line"),G.disable(),G=U,G.enable(),_.enable()},function(){Q.setIcon("ellipse"),G.disable(),G=O,G.enable(),_.enable()},function(){Q.setIcon("rectangle"),G.disable(),G=F,G.enable(),_.enable()},function(){Q.setIcon("bucket"),G.disable(),G=j,G.enable(),_.disable()}),X=b(L,function(){i(),a(),N()},function(e){if(N==g){var n=Q.colorButton;n!=Z.colorButton&&n.unmark(),Q.colorButton=e,e.mark()}else{var n=Z.colorButton;n!=Q.colorButton&&n.unmark(),Z.colorButton=e,e.mark()}},function(e){var n=e.color;ae.setColor(n.hue,n.saturation,n.luminance,1),q.enable(),X.hide(),oe.slide()}),Y=k(z,A),U=f(z,A),O=u(z,A),F=y(z,A),j=t(A),V=k(R,A),G=Y,q=B(A,function(e,n,t){ae.setColor(e,n,t,1)}),J=E(function(e){N==g?(z=e,Y.setSize(e),U.setSize(e),O.setSize(e),F.setSize(e)):(R=e,V.setSize(e))},function(){N()});J.setSize(z);var K=s(function(){A.operate(function(e){var n=e.canvas.width;e.fillStyle="#fff",e.globalAlpha=1,e.fillRect(0,0,n,n)},200),N()},function(e){A.operate(function(n){var t=A.element;C(n,e,t.offsetWidth,t.offsetHeight)},200),N()},function(){var e=A.element,n=e.offsetWidth,t=e.offsetHeight;T(A.canvas,n,t),N()}),Q=M("pencil",function(){Q.isChecked()&&(W.isVisible()?W.hide():W.show()),g()});Q.addClass(H+"-primaryToolButton"),Q.colorButton=X.blackButton;var Z=M("eraser",m);Z.addClass(H+"-eraserButton"),Z.colorButton=X.whiteButton,x(0,0,100,1),S(0,0,0,1);var $=n("palette",function(){$.isChecked()?N():(d(),l(),W.hide(),r(),a(),ie(),X.show(),$.check())});$.addClass(H+"-paletteButton"),$.showExpandable();var _=n("params",function(){_.isChecked()?N():(d(),l(),W.hide(),i(),a(),ie(),J.show(),_.check())});_.addClass(H+"-paramsButton"),_.showExpandable();var ee=P(A.undo);A.onUndoAvailable(ee.enable),A.onUndoUnavailable(ee.disable);var ne=n("burger",function(){ne.isChecked()?N():(d(),l(),W.hide(),i(),r(),ie(),K.show(),ne.check())});ne.addClass(H+"-fileButton"),ne.showExpandable();var te=c(H+"-content");te.appendChild(A.element),te.appendChild(W.element),te.appendChild(X.element),te.appendChild(J.element),te.appendChild(K.element);var ae=w(function(e,n,t){X.pickColor(e,n,t),L(e,n,t,1,X.getActiveButton())},function(){q.disable(),ie(),X.isEditVisible()?X.show():N()}),oe=p(ae);oe.addButton(Q),oe.addButton(Z),oe.addButton($),oe.addButton(_),oe.addButton(ee),oe.addButton(ne);var ie=oe.unslide,re=c(H);return re.appendChild(te),re.appendChild(oe.element),{element:re,resize:function(){var e=A.element;j.resize(e.offsetWidth,e.offsetHeight)},show:function(){g(),oe.show()}}}function C(e,n,t,a){var o,i,r=e.canvas,c=t/a,l=n.width/n.height;c>l?(o=t,i=o/l):(i=a,o=i*l);var u=(r.width-o)/2,d=(r.height-i)/2;e.globalAlpha=1,e.drawImage(n,u,d,o,i)}function b(e,n,t,a){function o(e){var n=e.hue,t=e.saturation,a=e.luminance,o=e.alpha;s.setColor(n,t,a,o),h.setColor(n,t,a,o)}var u="PalettePanel",d=r(function(a){b=a,t(a);var i=a.color;o(i),e(i.hue,i.saturation,i.luminance,i.alpha,a),s.isChecked()||n()}),s=i(function(){g&&(s.isChecked()?(h.hide(),s.uncheck(),C=!1):(h.show(),s.check(),C=!0))});s.setColor(0,0,0,1),s.addClass(u+"-previewButton"),s.showExpandable();var h=l(function(n,t,a,o){s.setColor(n,t,a,o),d.setColor(n,t,a,o),e(n,t,a,o,b)}),v=L(function(){a(b)}),f=c(u+"-secondLayer");f.appendChild(d.element),f.appendChild(s.element),f.appendChild(v.element);var m=c(u+"-content");m.appendChild(h.element),m.appendChild(f);var p=c(u);p.appendChild(m);var g=!1,C=!1,b=d.blackButton;return{blackButton:d.blackButton,element:p,whiteButton:d.whiteButton,getActiveButton:function(){return b},hide:function(){g&&(h.hide(),m.classList.remove("visible"),g=!1)},isEditVisible:function(){return C},select:function(e){b=e,d.select(e),o(e.color)},pickColor:function(e,n,t){var a=s.color.alpha;h.setColor(e,n,t,a),s.setColor(e,n,t,a),d.setColor(e,n,t,a)},show:function(){g||(C&&h.show(),m.classList.add("visible"),g=!0)}}}function E(e,n){function t(){l.clearRect(0,0,r.width,r.height),l.beginPath(),l.arc(r.width/2,r.height/2,(v+1)/2,0,2*Math.PI),l.fill()}var a="ParamsPanel",o=1,i=48,r=document.createElement("canvas");r.width=r.height=i+4,r.className=a+"-previewCanvas";var l=r.getContext("2d"),u=D(function(n){v=o+n*i,e(v),t()},n);u.addClass(a+"-slider");var d=c(a+"-content");d.appendChild(u.element),d.appendChild(r);var s=c(a);s.appendChild(d);var h=!1,v=o;return{element:s,hide:function(){u.abortTouch(),d.classList.remove("visible")},setColor:function(e,n,t){l.fillStyle="hsl("+e+", "+n+"%, "+t+"%)",h=!0},setSize:function(e){v=e,h=!0},show:function(){h&&(t(),h=!1,u.setRatio((v-o)/(i-o))),d.classList.add("visible")}}}function k(e,n){function t(t,a){!function(e,o,i){n.operate(function(n){n.lineWidth=e,n.fillStyle=i,n.beginPath(),n.arc(t,a,o,0,2*Math.PI),n.fill()},50)}(e,d,g)}function a(e){function n(){l?l=!1:(removeEventListener("mousemove",a),removeEventListener("mouseup",n))}function a(e){if(l)l=!1;else{var n=h.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top;o(r,c,t,a),r=t,c=a}}if(0===e.button)if(e.preventDefault(),l)l=!1;else{var i=h.getBoundingClientRect(),r=e.clientX-i.left,c=e.clientY-i.top;t(r,c),addEventListener("mousemove",a),addEventListener("mouseup",n)}}function o(t,a,o,i){!function(e,r){n.operate(function(n){n.lineWidth=e,n.strokeStyle=r,n.beginPath(),n.moveTo(t,a),n.lineTo(o,i),n.stroke()},50)}(e,g)}function i(e){l=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete u[n[t].identifier]}function r(e){l=!0,e.preventDefault();for(var n=h.getBoundingClientRect(),t=e.changedTouches,a=0;a<t.length;a++){var i=t[a],r=u[i.identifier];if(r){var c=i.clientX-n.left,d=i.clientY-n.top;o(r.x,r.y,c,d),r.x=c,r.y=d}}}function c(e){l=!0,e.preventDefault();for(var n=h.getBoundingClientRect(),a=e.changedTouches,o=0;o<a.length;o++){var i=a[o],r=i.clientX-n.left,c=i.clientY-n.top;t(r,c),u[i.identifier]={x:r,y:c}}}var l=!1,u={},d=e/2,s=!1,h=n.canvas,v=0,f=0,m=0,p=1,g="hsla(0, 0%, 0%, 1)";return{disable:function(){s&&(h.removeEventListener("mousedown",a),h.removeEventListener("touchstart",c),h.removeEventListener("touchmove",r),h.removeEventListener("touchend",i),h.removeEventListener("touchcancel",i),s=!1)},enable:function(){s||(h.addEventListener("mousedown",a),h.addEventListener("touchstart",c),h.addEventListener("touchmove",r),h.addEventListener("touchend",i),h.addEventListener("touchcancel",i),s=!0)},setColor:function(e,n,t,a){v=e,f=n,m=t,p=a,g="hsla("+v+", "+f+"%, "+m+"%, "+p+")"},setSize:function(n){e=n,d=e/2}}}function L(e){var t=n("pick",e);return t.addClass("PickButton"),t}function w(e,t){var a="PickPanel",o=i(function(){var n=o.color;e(n.hue,n.saturation,n.luminance),t()});o.addClass(a+"-colorButton");var r=n("cancel",t);r.addClass(a+"-cancelButton");var l=c(a);return l.appendChild(o.element),l.appendChild(r.element),{element:l,setColor:o.setColor}}function B(e,n){function t(e){var n=a(e);r(n[0],n[1])}function a(e){var n=f.getBoundingClientRect(),t=Math.floor(e.clientX-n.left),a=Math.floor(e.clientY-n.top);return[t,a]}function o(e){function n(e){e.preventDefault(),s?s=!1:i(e)}function a(e){e.preventDefault(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}0===e.button&&(e.preventDefault(),s?s=!1:(t(e),addEventListener("mousemove",n),addEventListener("mouseup",a)))}function i(e){var n=a(e),t=n[0],o=n[1];t>=0&&m>t&&o>=0&&p>o&&r(t,o)}function r(e,t){var a=4*(e+t*m),o=x(d[a],d[a+1],d[a+2]);n(o.hue,o.saturation,o.luminance)}function c(e){e.preventDefault(),s=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===h){h=null;break}}function l(e){e.preventDefault(),s=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===h){i(a);break}}}function u(e){if(e.preventDefault(),s=!0,null===h){var n=e.changedTouches[0];h=n.identifier,t(n)}}var d,s=!1,h=null,v=!1,f=e.canvas,m=f.width,p=f.height,g=f.getContext("2d");return{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",u),removeEventListener("touchmove",l),removeEventListener("touchend",c),removeEventListener("touchcancel",c),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",u),addEventListener("touchmove",l),addEventListener("touchend",c),addEventListener("touchcancel",c),v=!0,d=g.getImageData(0,0,m,p).data)}}}function y(e,n){function t(t){var o={};i(o,t);var r={x:o.x,y:o.y},c={color:b,endPoint:r,size:e,startPoint:o,end:function(){d.splice(d.indexOf(c),1),u(),n.operate(function(e){a(e,c)},200)},move:function(e){i(r,e),u()}};return d.push(c),u(),c}function a(e,n){var t=n.startPoint,a=t.x,o=t.y,i=n.endPoint;e.beginPath(),e.rect(a,o,i.x-a,i.y-o),e.strokeStyle=n.color,e.lineJoin="round",e.lineWidth=n.size,e.stroke()}function o(e){function n(e){o.move(e),u()}function a(){o.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var o=t(e);addEventListener("mousemove",n),addEventListener("mouseup",a)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=a.identifier,i=h[o];i&&(i.end(),delete h[o])}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=h[a.identifier];o&&o.move(a)}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++){var o=n[a];h[o.identifier]=t(o)}}function u(){k.clearRect(0,0,E.width,E.height),d.forEach(function(e){a(k,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,m=0,p=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",E=document.createElement("canvas");E.className="RectangleTool-overlayCanvas",E.width=f.width,E.height=f.height,E.style.top=f.style.top,E.style.left=f.style.left;var k=E.getContext("2d");return f.parentNode.appendChild(E),{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",l),f.removeEventListener("touchmove",c),f.removeEventListener("touchend",r),f.removeEventListener("touchcancel",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",l),f.addEventListener("touchmove",c),f.addEventListener("touchend",r),f.addEventListener("touchcancel",r),v=!0)},setColor:function(e,n,t,a){m=e,p=n,g=t,C=a,b="hsla("+m+", "+p+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function x(e,n,t){var a,o,i,r,c,l;if(e/=255,n/=255,t/=255,a=Math.max(e,n,t),o=Math.min(e,n,t),c=(a+o)/2,a==o)i=r=0;else{switch(l=a-o,r=c>.5?l/(2-a-o):l/(a+o),a){case e:i=(n-t)/l+(t>n?6:0);break;case n:i=(t-e)/l+2;break;case t:i=(e-n)/l+4}i/=6}return i=Math.floor(360*i),r=Math.floor(100*r),c=Math.floor(100*c),{hue:i,saturation:r,luminance:c}}function T(e,n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var o=(n-e.width)/2,i=(t-e.height)/2,r=a.getContext("2d");r.drawImage(e,o,i);var c=document.createElement("a");c.href=a.toDataURL("image/png"),c.download="picture.png",c.style.position="absolute",c.style.top=c.style.left=0,document.body.appendChild(c),c.click(),document.body.removeChild(c)}function S(e,n){function t(){var e="hsl("+a+", 100%, "+o+"%)",n="hsl("+a+", 0%, "+o+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",l.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var a=0,o=0,i="SaturationSlider",r=c(i+"-portraitBar"),l=c(i+"-landscapeBar"),u=D(function(n){e(100*n)},n);return u.addClass(i),u.barElement.appendChild(r),u.barElement.appendChild(l),t(),{abortTouch:u.abortTouch,element:u.element,setHue:function(e){a=e,t()},setLuminance:function(e){o=e,t()},setSaturation:function(e){u.setRatio(e/100)}}}function D(e,n){function t(t){function i(n){var t=h.getBoundingClientRect(),o=d.offsetHeight;if(innerWidth>innerHeight){var i=h.offsetHeight;u=1-(n.clientY-t.top-o/2)/i}else{var r=h.offsetWidth;u=(n.clientX-t.left-o/2)/r}u=Math.max(0,Math.min(1,u)),a(),e(u)}function c(){v(),n()}function v(){o=!1,l=null,s.remove("active"),removeEventListener("mousemove",f),removeEventListener("mouseup",m),removeEventListener("touchmove",g),removeEventListener("touchend",p),removeEventListener("touchcancel",p)}function f(e){r?r=!1:i(e)}function m(){r?r=!1:c()}function p(e){r=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===l){e.preventDefault(),c();break}}function g(e){r=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===l){e.preventDefault(),i(a);break}}}o=!0,i(t),s.add("active"),addEventListener("mousemove",f),addEventListener("mouseup",m),addEventListener("touchmove",g),addEventListener("touchend",p),addEventListener("touchcancel",p)}function a(){d.style.top=100*(1-u)+"%",d.style.left=100*u+"%"}var o=!1,i="Slider",r=!1,l=null,u=0,d=c(i+"-handle"),s=d.classList,h=c(i+"-handleWrapper");h.appendChild(d);var v=c(i+"-bar"),f=c(i);return f.appendChild(v),f.appendChild(h),f.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),r?r=!1:t(e))}),f.addEventListener("touchstart",function(e){if(r=!0,null===l){e.preventDefault();var n=e.changedTouches[0];l=n.identifier,t(n)}}),a(),{barElement:v,element:f,abortTouch:function(){o&&endSlide()},addClass:function(e){f.classList.add(e)},setRatio:function(e){u=e,a()}}}function M(e,t){var a=n(e,t),o="ToolButton",i=c(o+"-opaque"),r=c(o+"-color");r.appendChild(i);var l=c(o+"-transparency");l.style.backgroundImage="url(images/color-background.svg)",l.appendChild(r);var u=a.element,d=u.classList;return a.contentElement.appendChild(l),{addClass:a.addClass,check:a.check,element:u,hideExpandable:a.hideExpandable,isChecked:a.isChecked,setIcon:a.setIcon,showExpandable:a.showExpandable,uncheck:a.uncheck,mark:function(){d.add("marked")},setColor:function(e,n,t,a){var o=e+", "+n+"%, "+t+"%",c="hsla("+o+", "+a+")";r.style.background=c;var l="hsl("+o+")";i.style.background=l},unmark:function(){d.remove("marked")}}}function I(e,t,a,o,i){function r(){p.remove("visible"),g=!1}var l="ToolPanel",u=n("pencil",function(){d.uncheck(),s.uncheck(),h.uncheck(),v.uncheck(),u.check(),e(),r()});u.addClass(l+"-pencilButton"),u.check();var d=n("line",function(){u.uncheck(),s.uncheck(),h.uncheck(),v.uncheck(),d.check(),t(),r()});d.addClass(l+"-lineButton");var s=n("ellipse",function(){u.uncheck(),d.uncheck(),h.uncheck(),v.uncheck(),s.check(),a(),r()});s.addClass(l+"-ellipseButton");var h=n("rectangle",function(){u.uncheck(),d.uncheck(),s.uncheck(),v.uncheck(),h.check(),o(),r()});h.addClass(l+"-rectangleButton");var v=n("bucket",function(){u.uncheck(),d.uncheck(),s.uncheck(),h.uncheck(),v.check(),i(),r()});v.addClass(l+"-bucketButton");var f=c(l+"-content");f.appendChild(u.element),f.appendChild(d.element),f.appendChild(s.element),f.appendChild(h.element),f.appendChild(v.element);var m=c(l);m.appendChild(f);var p=f.classList,g=!1;return{element:m,hide:r,isVisible:function(){return g},show:function(){p.add("visible"),g=!0}}}function P(e){function n(){function n(){removeEventListener("mouseup",t),removeEventListener("touchend",a),removeEventListener("touchcancel",a),l.remove("active"),clearTimeout(o)}function t(){c?c=!1:n()}function a(e){c=!0;for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===r&&(r=null,n())}function i(){o=setTimeout(i,e())}var c=!1;addEventListener("mouseup",t),addEventListener("touchend",a),addEventListener("touchcancel",a),l.add("active"),i()}var t=c("Button-content");t.style.backgroundImage="url(images/undo.svg)";var a=c("Button UndoButton disabled");a.appendChild(t),a.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),i?i=!1:n())}),a.addEventListener("touchstart",function(e){i=!0,null===r&&(e.preventDefault(),r=e.changedTouches[0].identifier,n())});var o,i=!1,r=null,l=a.classList;return{element:a,disable:function(){l.add("disabled")},enable:function(){l.remove("disabled")}}}!function(){var e=c("Main-horizontalProgress"),n=c("Main-verticalProgress"),t=c("Main-loadBar");t.appendChild(e),t.appendChild(n);var a=g(),o=document.body;o.appendChild(a.element),o.appendChild(t);var i=0,r=["bucket","burger","ellipse","eraser","left-expandable","line","palette","params","pencil","rectangle","top-expandable","undo"];r.forEach(function(c){var l=new Image;l.src="images/"+c+".svg",l.onload=l.onerror=l.onabort=function(){i++;var c=i/r.length*100+"%";e.style.width=c,n.style.height=c,i==r.length&&(a.show(),setTimeout(function(){t.classList.add("hidden"),setTimeout(function(){o.removeChild(t)},250)},250))}});var l=a.resize;addEventListener("resize",l),l()}()}();