!function(){function e(e,n){function t(){var e=l+", "+d+"%, "+c+"%",n="hsl("+e+")",t="hsla("+e+", 0)",a="url(images/color-background.svg)",r="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";i.style.backgroundImage="linear-gradient("+r+"), linear-gradient(90deg, "+t+", "+n+"), "+a,o.style.backgroundImage="linear-gradient(90deg, "+r+"), linear-gradient("+n+", "+t+"), "+a}var a="AlphaSlider",i=r(a+"-portraitBar"),o=r(a+"-landscapeBar"),l=0,d=0,c=0,u=C(function(n){e(n),t()},n);return u.setRatio(1),u.addClass(a),u.barElement.appendChild(i),u.barElement.appendChild(o),t(),{abortTouch:u.abortTouch,element:u.element,setAlpha:u.setRatio,setHue:function(e){l=e,t()},setLuminance:function(e){c=e,t()},setSaturation:function(e){d=e,t()}}}function n(e,n){function t(){n(),c.add("active"),clearTimeout(l),l=setTimeout(function(){c.remove("active")},100)}var a=!1,i=r("Button-content");i.style.backgroundImage="url(images/"+e+".svg)";var o=r("Button");o.appendChild(i),o.addEventListener("mousedown",function(e){e.preventDefault(),a?a=!1:t()}),o.addEventListener("touchstart",function(e){a=!0,e.preventDefault(),t()});var l,d=!1,c=o.classList;return{element:o,addClass:function(e){c.add(e)},check:function(){c.add("checked"),d=!0},isChecked:function(){return d},uncheck:function(){c.remove("checked"),d=!1}}}function t(e,n){function t(t,a){!function(e,i,o){n.operate(function(n){n.lineWidth=e,n.fillStyle=o,n.beginPath(),n.arc(t,a,i,0,2*Math.PI),n.fill()})}(e,p,k)}function a(e){if(e.preventDefault(),h)h=!1;else{f=!0;var n=g.getBoundingClientRect();u=e.clientX-n.left,s=e.clientY-n.top,t(u,s)}}function i(){h?h=!1:f=!1}function o(e){if(h)h=!1;else if(f){var n=g.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top;r(u,s,t,a),u=t,s=a}}function r(t,a,i,o){!function(e,r){n.operate(function(n){n.lineWidth=e,n.strokeStyle=r,n.beginPath(),n.moveTo(t,a),n.lineTo(i,o),n.stroke()})}(e,k)}function l(e){h=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete v[n[t].identifier]}function d(e){h=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),t=e.changedTouches,a=0;a<t.length;a++){var i=t[a],o=v[i.identifier];if(o){var l=i.clientX-n.left,d=i.clientY-n.top;r(o.x,o.y,l,d),o.x=l,o.y=d}}}function c(e){h=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),a=e.changedTouches,i=0;i<a.length;i++){var o=a[i],r=o.clientX-n.left,l=o.clientY-n.top;t(r,l),v[o.identifier]={x:r,y:l}}}var u,s,f=!1,h=!1,v={},p=e/2,m=!1,g=n.canvas,C=0,b=0,L=0,E=1,k="hsla(0, 0%, 0%, 1)";return{disable:function(){m&&(g.removeEventListener("mousedown",a),g.removeEventListener("mousemove",o),g.removeEventListener("mouseup",i),g.removeEventListener("touchstart",c),g.removeEventListener("touchmove",d),g.removeEventListener("touchend",l),m=!1)},enable:function(){m||(g.addEventListener("mousedown",a),g.addEventListener("mousemove",o),g.addEventListener("mouseup",i),g.addEventListener("touchstart",c),g.addEventListener("touchmove",d),g.addEventListener("touchend",l),m=!0)},setColor:function(e,n,t,a){C=e,b=n,L=t,E=a,k="hsla("+C+", "+b+"%, "+L+"%, "+E+")"},setSize:function(n){e=n,p=e/2}}}function a(){var e="Canvas",n=Math.max(screen.width,screen.height),t=document.createElement("canvas");t.className=e+"-canvas",t.width=t.height=n,t.style.left=t.style.top=-n/2+"px";var a=t.getContext("2d");a.lineCap="round",a.fillStyle="#fff",a.fillRect(0,0,n,n);var i=r(e+"-center");i.appendChild(t);var o=r(e);o.appendChild(i);var l,d,c=[],u=128,s=[];return{canvas:t,element:o,onUndoAvailable:function(e){l=e},onUndoUnavailable:function(e){d=e},operate:function(e){c.push(e),1==c.length&&l(),e(a);var t=c.length-u;if(!(0>t)){var i=Math.floor(t/u);if(!s[i]){var o=document.createElement("canvas");o.width=o.height=n;var r=o.getContext("2d");r.lineCap="round",i?r.drawImage(s[i-1],0,0):(r.fillStyle="#fff",r.fillRect(0,0,n,n)),s.push(o);for(var d=t;t+u>d;d++)c[d](r)}}},undo:function(){if(a.globalAlpha=1,s.length?a.drawImage(s[s.length-1],0,0):(a.fillStyle="#fff",a.fillRect(0,0,n,n)),c.length){c.pop();for(var e=s.length*u,t=e;t<c.length;t++)c[t](a);s.length*u>c.length&&s.pop(),c.length||d()}}}}function i(e,n,t,a,i){function o(){i(),p.add("active"),clearTimeout(h),h=setTimeout(function(){p.remove("active")},100)}function l(e,n,t,a){var i="hsla("+e+", "+n+"%, "+t+"%, "+a+")";u.style.backgroundColor=i}var d=!1,c="ColorButton",u=r(c+"-color"),s=r(c+"-transparency Button-content");s.appendChild(u),s.style.backgroundImage="url(images/color-background.svg)";var f=r("Button");f.appendChild(s),f.addEventListener("mousedown",function(e){e.preventDefault(),d?d=!1:o()}),f.addEventListener("touchstart",function(e){d=!0,e.preventDefault(),o()});var h,v=!1,p=f.classList;return l(e,n,t,a),{element:f,setColor:l,addClass:function(e){p.add(e)},check:function(){p.add("checked"),v=!0},isChecked:function(){return v},uncheck:function(){p.remove("checked"),v=!1}}}function o(e){function n(n,o,r,l){var d=i(n,o,r,l,function(){t.forEach(function(e){e.uncheck()}),d.check(),C=c,e(n,o,r,l)});d.addClass(a+"-colorButton"),t.push(d);var c={addClass:d.addClass,check:d.check,element:d.element,setColor:function(e,t,a,i){n=e,o=t,r=a,l=i,d.setColor(n,o,r,l)}};return c}var t=[],a="ColorButtonsPanel",o=n(0,0,0,1);o.addClass(a+"-blackButton"),o.check();var l=n(4,100,47,1);l.addClass(a+"-redButton");var d=n(115,87,50,1);d.addClass(a+"-greenButton");var c=n(232,100,50,1);c.addClass(a+"-blueButton");var u=n(0,0,53,1);u.addClass(a+"-greyButton");var s=n(30,100,33,1);s.addClass(a+"-brownButton");var f=n(114,100,33,1);f.addClass(a+"-darkGreenButton");var h=n(210,100,80,1);h.addClass(a+"-skyBlueButton");var v=n(60,100,50,1);v.addClass(a+"-yellowButton");var p=n(32,100,50,1);p.addClass(a+"-orangeButton");var m=n(306,100,33,1);m.addClass(a+"-violetButton");var g=n(312,100,83,1);g.addClass(a+"-pinkButton");var C=o,b=r(a);return b.appendChild(o.element),b.appendChild(u.element),b.appendChild(c.element),b.appendChild(h.element),b.appendChild(f.element),b.appendChild(d.element),b.appendChild(l.element),b.appendChild(v.element),b.appendChild(s.element),b.appendChild(p.element),b.appendChild(m.element),b.appendChild(g.element),{element:b,setColor:function(e,n,t,a){C.setColor(e,n,t,a)}}}function r(e){var n=document.createElement("div");return n.className=e,n}function l(n){function t(){u.abortTouch(),h.abortTouch(),v.abortTouch()}function a(){n(i,o,l,d)}var i=0,o=0,l=0,d=1,c="EditColorPanel",u=s(function(e){i=e,a(),h.setHue(i),v.setHue(i),p.setHue(i)},a),h=g(function(e){o=e,a(),v.setSaturation(o),p.setSaturation(o)},a),v=f(function(e){l=e,a(),h.setLuminance(l),p.setLuminance(l)},a),p=e(function(e){d=e,a()},a),m=r(c);return m.appendChild(u.element),m.appendChild(h.element),m.appendChild(v.element),m.appendChild(p.element),{element:m,hide:function(){t(),p.abortTouch(),m.classList.remove("visible")},setColor:function(e,n,a,r){t(),i=e,o=n,l=a,d=r,u.setHue(i),h.setHue(i),h.setSaturation(o),h.setLuminance(l),v.setHue(i),v.setSaturation(o),v.setLuminance(l),p.setHue(i),p.setSaturation(o),p.setLuminance(l),p.setAlpha(d)},show:function(){m.classList.add("visible")}}}function d(e,n){function t(t,a){!function(e,i){n.operate(function(n){n.lineWidth=e,n.fillStyle=C,n.beginPath(),n.arc(t,a,i,0,2*Math.PI),n.fill()})}(e,p)}function a(e){if(e.preventDefault(),h)h=!1;else{f=!0;var n=g.getBoundingClientRect();u=e.clientX-n.left,s=e.clientY-n.top,t(u,s)}}function i(){h?h=!1:f=!1}function o(e){if(h)h=!1;else if(f){var n=g.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top;r(u,s,t,a),u=t,s=a}}function r(t,a,i,o){!function(e){n.operate(function(n){n.lineWidth=e,n.strokeStyle=C,n.beginPath(),n.moveTo(t,a),n.lineTo(i,o),n.stroke()})}(e)}function l(e){h=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete v[n[t].identifier]}function d(e){h=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),t=e.changedTouches,a=0;a<t.length;a++){var i=t[a],o=v[i.identifier];if(o){var l=i.clientX-n.left,d=i.clientY-n.top;r(o.x,o.y,l,d),o.x=l,o.y=d}}}function c(e){h=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),a=e.changedTouches,i=0;i<a.length;i++){var o=a[i],r=o.clientX-n.left,l=o.clientY-n.top;t(r,l),v[o.identifier]={x:r,y:l}}}var u,s,f=!1,h=!1,v={},p=e/2,m=!1,g=n.canvas,C="#fff";return{disable:function(){m&&(g.removeEventListener("mousedown",a),g.removeEventListener("mousemove",o),g.removeEventListener("mouseup",i),g.removeEventListener("touchstart",c),g.removeEventListener("touchmove",d),g.removeEventListener("touchend",l),m=!1)},enable:function(){m||(g.addEventListener("mousedown",a),g.addEventListener("mousemove",o),g.addEventListener("mouseup",i),g.addEventListener("touchstart",c),g.addEventListener("touchmove",d),g.addEventListener("touchend",l),m=!0)},setSize:function(n){e=n,p=e/2}}}function c(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){var e=new Image;e.src=a.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},a.onabort=function(){},a.onerror=function(){},i.removeChild(e),t()}),i.appendChild(e)}var a=r("Button-content");a.style.backgroundImage="url(images/"+e+".svg)";var i=r("Button");return i.appendChild(a),t(),{element:i,addClass:function(e){i.classList.add(e)}}}function u(e,t,a){var i="FilePanel",o=n("file",e);o.addClass(i+"-newButton");var l=c("open",t);l.addClass(i+"-openButton");var d=n("save",a);d.addClass(i+"-saveButton");var u=r(i+"-content");u.appendChild(o.element),u.appendChild(l.element),u.appendChild(d.element);var s=r(i);s.appendChild(u);var f=u.classList;return{element:s,hide:function(){f.remove("visible")},show:function(){f.add("visible")}}}function s(e,n){var t=C(function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function f(e,n){function t(){var e="hsl("+a+", "+i+"%, 0%)",n="hsl("+a+", "+i+"%, 50%)",t="hsl("+a+", "+i+"%, 100%)",o="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";l.style.backgroundImage="linear-gradient("+o+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",d.style.backgroundImage="linear-gradient(90deg, "+o+"), linear-gradient("+t+", "+n+", "+e+")"}var a=0,i=0,o="LuminanceSlider",l=r(o+"-portraitBar"),d=r(o+"-landscapeBar"),c=C(function(n){e(100*n)},n);return c.addClass(o),c.barElement.appendChild(l),c.barElement.appendChild(d),t(),{abortTouch:c.abortTouch,element:c.element,setHue:function(e){a=e,t()},setLuminance:function(e){c.setRatio(e/100)},setSaturation:function(e){i=e,t()}}}function h(){function e(){i(),o(),l(),s(),f(),k=e}function i(){w.hide(),D.uncheck()}function o(){T.hide(),H.uncheck()}function l(){S.hide(),x.uncheck()}function c(){R.uncheck(),B.disable()}function s(){I.uncheck(),y.disable()}function f(){R.check(),B.enable()}function h(){I.check(),y.enable()}function g(){i(),o(),l(),c(),h(),k=g}var C=4,L="MainPanel",E=a(),k=e,B=t(C,E);B.enable();var y=d(C,E),w=v(function(e,n,t,a){B.setColor(e,n,t,a),T.setColor(e,n,t)},function(){i(),l(),f()}),T=p(C,function(e){B.setSize(e),y.setSize(e)},function(){k()}),S=u(function(){E.operate(function(e){var n=e.canvas.width;e.fillStyle="#fff",e.globalAlpha=1,e.fillRect(0,0,n,n)}),k()},function(e){E.operate(function(n){var t=n.canvas.width,a=(t-e.width)/2,i=(t-e.height)/2;n.globalAlpha=1,n.drawImage(e,a,i)}),k()},function(){var e=E.element.offsetWidth,n=E.element.offsetHeight;m(E.canvas,e,n),k()}),R=n("pencil",e);R.addClass(L+"-brushButton"),R.check();var I=n("eraser",g);I.addClass(L+"-eraserButton");var D=n("palette",function(){D.isChecked()?k():(o(),l(),c(),s(),w.show(),D.check())});D.addClass(L+"-paletteButton");var H=n("params",function(){H.isChecked()?k():(i(),l(),c(),s(),T.show(),H.check())});H.addClass(L+"-paramsButton");var P=b(E.undo);E.onUndoAvailable(P.enable),E.onUndoUnavailable(P.disable);var x=n("burger",function(){x.isChecked()?k():(i(),o(),c(),s(),S.show(),x.check())});x.addClass(L+"-fileButton");var M=r(L+"-content");M.appendChild(E.element),M.appendChild(w.element),M.appendChild(T.element),M.appendChild(S.element);var A=r(L+"-bar");A.appendChild(R.element),A.appendChild(I.element),A.appendChild(D.element),A.appendChild(H.element),A.appendChild(P.element),A.appendChild(x.element);var U=r(L);return U.appendChild(M),U.appendChild(A),{element:U}}function v(e,n){var t="PalettePanel",a=o(function(t,a,i,o){d.setColor(t,a,i,o),c.setColor(t,a,i,o),e(t,a,i,o),d.isChecked()||n()}),d=i(0,0,0,1,function(){d.isChecked()?(c.hide(),d.uncheck(),h=!1):(c.show(),d.check(),h=!0)});d.addClass(t+"-previewButton");var c=l(function(n,t,i,o){d.setColor(n,t,i,o),a.setColor(n,t,i,o),e(n,t,i,o)}),u=r(t+"-secondLayer");u.appendChild(a.element),u.appendChild(d.element);var s=r(t+"-content");s.appendChild(c.element),s.appendChild(u);var f=r(t);f.appendChild(s);var h=!1;return{element:f,hide:function(){c.hide(),s.classList.remove("visible")},show:function(){h&&c.show(),s.classList.add("visible")}}}function p(e,n,t){function a(){c.clearRect(0,0,d.width,d.height),c.beginPath(),c.arc(d.width/2,d.height/2,(e+1)/2,0,2*Math.PI),c.fill()}var i="ParamsPanel",o=1,l=48,d=document.createElement("canvas");d.width=d.height=l+4,d.className=i+"-previewCanvas";var c=d.getContext("2d"),u=C(function(t){e=o+t*l,n(e),a()},t);u.setRatio((e-o)/(l-o)),u.addClass(i+"-slider");var s=r(i+"-content");s.appendChild(u.element),s.appendChild(d);var f=r(i);f.appendChild(s),a();var h=!1;return{element:f,hide:function(){u.abortTouch(),s.classList.remove("visible")},setColor:function(e,n,t){c.fillStyle="hsl("+e+", "+n+"%, "+t+"%)",h=!0},show:function(){h&&(a(),h=!1),s.classList.add("visible")}}}function m(e,n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var i=(n-e.width)/2,o=(t-e.height)/2,r=a.getContext("2d");r.drawImage(e,i,o);var l=document.createElement("a");l.href=a.toDataURL("image/png"),l.download="picture.png",l.style.position="absolute",l.style.top=l.style.left=0,document.body.appendChild(l),l.click(),document.body.removeChild(l)}function g(e,n){function t(){var e="hsl("+a+", 100%, "+i+"%)",n="hsl("+a+", 0%, "+i+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";l.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",d.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var a=0,i=0,o="SaturationSlider",l=r(o+"-portraitBar"),d=r(o+"-landscapeBar"),c=C(function(n){e(100*n)},n);return c.addClass(o),c.barElement.appendChild(l),c.barElement.appendChild(d),t(),{abortTouch:c.abortTouch,element:c.element,setHue:function(e){a=e,t()},setLuminance:function(e){i=e,t()},setSaturation:function(e){c.setRatio(e/100)}}}function C(e,n){function t(t){function o(n){var t=f.getBoundingClientRect(),i=u.offsetHeight;if(innerWidth>innerHeight){var o=f.offsetHeight;c=1-(n.clientY-t.top-i/2)/o}else{var r=f.offsetWidth;c=(n.clientX-t.left-i/2)/r}c=Math.max(0,Math.min(1,c)),a(),e(c)}function r(){endSlide(),n()}function h(e){l?l=!1:o(e)}function v(){l?l=!1:r()}function p(e){l=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===d){e.preventDefault(),r();break}}function m(e){l=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===d){e.preventDefault(),o(a);break}}}endSlide=function(){i=!1,d=null,s.remove("active"),removeEventListener("mousemove",h),removeEventListener("mouseup",v),removeEventListener("touchmove",m),removeEventListener("touchend",p)},i=!0,o(t),s.add("active"),addEventListener("mousemove",h),addEventListener("mouseup",v),addEventListener("touchmove",m),addEventListener("touchend",p)}function a(){u.style.top=100*(1-c)+"%",u.style.left=100*c+"%"}var i=!1,o="Slider",l=!1,d=null,c=0,u=r(o+"-handle"),s=u.classList,f=r(o+"-handleWrapper");f.appendChild(u);var h=r(o+"-bar"),v=r(o);return v.appendChild(h),v.appendChild(f),v.addEventListener("mousedown",function(e){e.preventDefault(),l?l=!1:t(e)}),v.addEventListener("touchstart",function(e){if(l=!0,null===d){e.preventDefault();var n=e.changedTouches[0];d=n.identifier,t(n)}}),a(),{barElement:h,element:v,abortTouch:function(){i&&endSlide()},addClass:function(e){v.classList.add(e)},setRatio:function(e){c=e,a()}}}function b(e){function n(){function n(){removeEventListener("mouseup",t),removeEventListener("touchend",a),d.remove("active"),clearInterval(i)}function t(){o?o=!1:n()}function a(e){o=!0;for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===l&&(l=null,n())}var o=!1;addEventListener("touchend",a),addEventListener("mouseup",t),d.add("active"),i=setInterval(e,50),e()}var t=r("Button-content");t.style.backgroundImage="url(images/undo.svg)";var a=r("Button UndoButton disabled");a.appendChild(t),a.addEventListener("mousedown",function(e){e.preventDefault(),o?o=!1:n()}),a.addEventListener("touchstart",function(e){o=!0,null===l&&(e.preventDefault(),l=e.changedTouches[0].identifier,n())});var i,o=!1,l=null,d=a.classList;return{element:a,disable:function(){d.add("disabled")},enable:function(){d.remove("disabled")}}}!function(){var e=r("Main-progress"),n=r("Main-loadBar");n.appendChild(e),document.body.appendChild(n);var t=0,a=["pencil","eraser","palette","params","undo","burger"];a.forEach(function(i){var o=new Image;o.src="images/"+i+".svg",o.onload=o.onerror=o.onabort=function(){if(t++,e.style.width=t/a.length*100+"%",t==a.length){var i=h();document.body.removeChild(n),document.body.appendChild(i.element)}}})}()}();