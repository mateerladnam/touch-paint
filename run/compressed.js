!function(){function e(e,n){function t(){var e=l+", "+d+"%, "+c+"%",n="hsl("+e+")",t="hsla("+e+", 0)",a="url(images/color-background.svg)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";o.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+t+", "+n+"), "+a,r.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+n+", "+t+"), "+a}var a="AlphaSlider",o=i(a+"-portraitBar"),r=i(a+"-landscapeBar"),l=0,d=0,c=0,u=C(function(n){e(n),t()},n);return u.setRatio(1),u.addClass(a),u.barElement.appendChild(o),u.barElement.appendChild(r),t(),{abortTouch:u.abortTouch,element:u.element,setAlpha:u.setRatio,setHue:function(e){l=e,t()},setLuminance:function(e){c=e,t()},setSaturation:function(e){d=e,t()}}}function n(e,n){function t(){n(),c.add("active"),clearTimeout(l),l=setTimeout(function(){c.remove("active")},100)}var a=!1,o=i("Button-content");o.style.backgroundImage="url(images/"+e+".svg)";var r=i("Button");r.appendChild(o),r.addEventListener("mousedown",function(e){e.preventDefault(),a?a=!1:t()}),r.addEventListener("touchstart",function(e){a=!0,e.preventDefault(),t()});var l,d=!1,c=r.classList;return{contentElement:o,element:r,addClass:function(e){c.add(e)},check:function(){c.add("checked"),d=!0},isChecked:function(){return d},uncheck:function(){c.remove("checked"),d=!1}}}function t(){var e="Canvas",n=Math.max(screen.width,screen.height),t=document.createElement("canvas");t.className=e+"-canvas",t.width=t.height=n,t.style.left=t.style.top=-n/2+"px";var a=t.getContext("2d");a.lineCap="round",a.fillStyle="#fff",a.fillRect(0,0,n,n);var o=i(e+"-center");o.appendChild(t);var r=i(e);r.appendChild(o);var l,d,c=[],u=128,s=[];return{canvas:t,element:r,onUndoAvailable:function(e){l=e},onUndoUnavailable:function(e){d=e},operate:function(e){c.push(e),1==c.length&&l(),e(a);var t=c.length-u;if(!(0>t)){var o=Math.floor(t/u);if(!s[o]){var i=document.createElement("canvas");i.width=i.height=n;var r=i.getContext("2d");r.lineCap="round",o?r.drawImage(s[o-1],0,0):(r.fillStyle="#fff",r.fillRect(0,0,n,n)),s.push(i);for(var d=t;t+u>d;d++)c[d](r)}}},undo:function(){if(a.globalAlpha=1,s.length?a.drawImage(s[s.length-1],0,0):(a.fillStyle="#fff",a.fillRect(0,0,n,n)),c.length){c.pop();for(var e=s.length*u,t=e;t<c.length;t++)c[t](a);s.length*u>c.length&&s.pop(),c.length||d()}}}}function a(e){function n(){e(),s.add("active"),clearTimeout(c),c=setTimeout(function(){s.remove("active")},100)}var t=!1,a="ColorButton",o=i(a+"-opaque"),r=i(a+"-color");r.appendChild(o);var l=i(a+"-transparency Button-content");l.appendChild(r),l.style.backgroundImage="url(images/color-background.svg)";var d=i("Button");d.appendChild(l),d.addEventListener("mousedown",function(e){e.preventDefault(),t?t=!1:n()}),d.addEventListener("touchstart",function(e){t=!0,e.preventDefault(),n()});var c,u=!1,s=d.classList,h={};return{color:h,element:d,addClass:function(e){s.add(e)},check:function(){s.add("checked"),u=!0},isChecked:function(){return u},mark:function(){s.add("marked")},setColor:function(e,n,t,a){h.hue=e,h.saturation=n,h.luminance=t,h.alpha=a;var i=e+", "+n+"%, "+t+"%",l="hsla("+i+", "+a+")";r.style.backgroundColor=l;var d="hsl("+i+")";o.style.backgroundColor=d},uncheck:function(){s.remove("checked"),u=!1},unmark:function(){s.remove("marked")}}}function o(e){function n(n,i,l,d){var c=a(function(){t(c),e(c)});return c.setColor(n,i,l,1),c.addClass(r+"-colorButton"),c.addClass(r+"-"+d+"Button"),o.push(c),c}function t(e){E.uncheck(),e.check(),E=e,w.setColor=e.setColor}var o=[],r="ColorButtonsPanel",l=n(0,0,0,"black");l.check(),l.mark();var d=n(0,0,40,"darkGrey"),c=n(0,0,70,"lightGrey"),u=n(0,0,100,"white");u.mark();var s=n(232,100,50,"blue"),h=n(210,100,80,"skyBlue"),f=n(114,100,33,"darkGreen"),v=n(115,87,50,"green"),p=n(4,100,47,"red"),m=n(60,100,50,"yellow"),g=n(30,100,33,"brown"),C=n(32,100,50,"orange"),b=n(306,100,33,"violet"),k=n(312,100,83,"pink"),L=n(30,55,65,"darkSkin"),B=n(31,55,75,"lightSkin"),E=l,y=i(r);y.appendChild(l.element),y.appendChild(d.element),y.appendChild(c.element),y.appendChild(u.element),y.appendChild(s.element),y.appendChild(h.element),y.appendChild(f.element),y.appendChild(v.element),y.appendChild(p.element),y.appendChild(m.element),y.appendChild(g.element),y.appendChild(C.element),y.appendChild(b.element),y.appendChild(k.element),y.appendChild(L.element),y.appendChild(B.element);var w={blackButton:l,element:y,select:t,whiteButton:u,setColor:E.setColor};return w}function i(e){var n=document.createElement("div");return n.className=e,n}function r(n){function t(){h.abortTouch(),f.abortTouch(),v.abortTouch()}function a(){n(o,r,l,d)}var o=0,r=0,l=0,d=1,s="EditColorPanel",h=c(function(e){o=e,a(),f.setHue(o),v.setHue(o),p.setHue(o)},a),f=g(function(e){r=e,a(),v.setSaturation(r),p.setSaturation(r)},a),v=u(function(e){l=e,a(),f.setLuminance(l),p.setLuminance(l)},a),p=e(function(e){d=e,a()},a),m=i(s);return m.appendChild(h.element),m.appendChild(f.element),m.appendChild(v.element),m.appendChild(p.element),{element:m,hide:function(){t(),p.abortTouch(),m.classList.remove("visible")},setColor:function(e,n,a,i){t(),o=e,r=n,l=a,d=i,h.setHue(o),f.setHue(o),f.setSaturation(r),f.setLuminance(l),v.setHue(o),v.setSaturation(r),v.setLuminance(l),p.setHue(o),p.setSaturation(r),p.setLuminance(l),p.setAlpha(d)},show:function(){m.classList.add("visible")}}}function l(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){var e=new Image;e.src=a.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},a.onabort=function(){},a.onerror=function(){},o.removeChild(e),t()}),o.appendChild(e)}var a=i("Button-content");a.style.backgroundImage="url(images/"+e+".svg)";var o=i("Button");return o.appendChild(a),t(),{element:o,addClass:function(e){o.classList.add(e)}}}function d(e,t,a){var o="FilePanel",r=n("file",e);r.addClass(o+"-newButton");var d=l("open",t);d.addClass(o+"-openButton");var c=n("save",a);c.addClass(o+"-saveButton");var u=i(o+"-content");u.appendChild(r.element),u.appendChild(d.element),u.appendChild(c.element);var s=i(o);s.appendChild(u);var h=u.classList;return{element:s,hide:function(){h.remove("visible")},show:function(){h.add("visible")}}}function c(e,n){var t=C(function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function u(e,n){function t(){var e="hsl("+a+", "+o+"%, 0%)",n="hsl("+a+", "+o+"%, 50%)",t="hsl("+a+", "+o+"%, 100%)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";l.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",d.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+t+", "+n+", "+e+")"}var a=0,o=0,r="LuminanceSlider",l=i(r+"-portraitBar"),d=i(r+"-landscapeBar"),c=C(function(n){e(100*n)},n);return c.addClass(r),c.barElement.appendChild(l),c.barElement.appendChild(d),t(),{abortTouch:c.abortTouch,element:c.element,setHue:function(e){a=e,t()},setLuminance:function(e){c.setRatio(e/100)},setSaturation:function(e){o=e,t()}}}function s(){function e(){o(),r(),a()}function a(){x.hide(),X.uncheck()}function o(){R.hide(),U.uncheck()}function r(){P.hide(),z.uncheck()}function l(){M.uncheck(),D.disable()}function c(){A.uncheck(),H.disable()}function u(){M.check(),D.enable()}function s(){A.check(),H.enable()}function g(){e(),c(),u(),P.setSize(w),M.mark(),A.unmark(),E(D),I=g}function C(){e(),l(),s(),P.setSize(y),A.mark(),M.unmark(),E(H),I=C}function L(e,n,t,a){D.setColor(e,n,t,a),M.setColor(e,n,t,a)}function B(e,n,t,a){H.setColor(e,n,t,a),A.setColor(e,n,t,a)}function E(e){var n=e.colorButton;R.select(n);var t=n.color,a=t.hue,o=t.saturation,i=t.luminance;e.setColor(a,o,i,t.alpha),P.setColor(a,o,i)}var y=4,w=8,S="MainPanel",T=t(),I=C,R=f(function(e,n,t,a,o){o==H.colorButton&&B(e,n,t,a),o==D.colorButton&&L(e,n,t,a),P.setColor(e,n,t)},function(){o(),a(),I()},function(e){if(I==C){var n=H.colorButton;n!=D.colorButton&&n.unmark(),H.colorButton=e,e.mark()}else{var n=D.colorButton;n!=H.colorButton&&n.unmark(),D.colorButton=e,e.mark()}}),H=p(y,T);H.colorButton=R.blackButton,H.enable();var D=p(w,T);D.colorButton=R.whiteButton;var P=v(function(e){I==C?(y=e,H.setSize(e)):(w=e,D.setSize(e))},function(){I()});P.setSize(y);var x=d(function(){T.operate(function(e){var n=e.canvas.width;e.fillStyle="#fff",e.globalAlpha=1,e.fillRect(0,0,n,n)}),I()},function(e){T.operate(function(n){var t=T.element;h(n,e,t.offsetWidth,t.offsetHeight)}),I()},function(){var e=T.element.offsetWidth,n=T.element.offsetHeight;m(T.canvas,e,n),I()}),A=b("pencil",C);A.addClass(S+"-pencilButton"),A.check();var M=b("eraser",g);M.addClass(S+"-eraserButton"),L(0,0,100,1),B(0,0,0,1);var U=n("palette",function(){U.isChecked()?I():(r(),a(),c(),l(),R.show(),U.check())});U.addClass(S+"-paletteButton");var z=n("params",function(){z.isChecked()?I():(o(),a(),c(),l(),P.show(),z.check())});z.addClass(S+"-paramsButton");var W=k(T.undo);T.onUndoAvailable(W.enable),T.onUndoUnavailable(W.disable);var X=n("burger",function(){X.isChecked()?I():(o(),r(),c(),l(),x.show(),X.check())});X.addClass(S+"-fileButton");var Y=i(S+"-content");Y.appendChild(T.element),Y.appendChild(R.element),Y.appendChild(P.element),Y.appendChild(x.element);var N=i(S+"-bar");N.appendChild(A.element),N.appendChild(M.element),N.appendChild(U.element),N.appendChild(z.element),N.appendChild(W.element),N.appendChild(X.element);var F=i(S);return F.appendChild(Y),F.appendChild(N),{element:F}}function h(e,n,t,a){var o,i,r=e.canvas,l=t/a,d=n.width/n.height;l>d?(o=t,i=o/d):(i=a,o=i*d);var c=(r.width-o)/2,u=(r.height-i)/2;e.globalAlpha=1,e.drawImage(n,c,u,o,i)}function f(e,n,t){function l(e){var n=e.hue,t=e.saturation,a=e.luminance,o=e.alpha;u.setColor(n,t,a,o),s.setColor(n,t,a,o)}var d="PalettePanel",c=o(function(a){m=a,t(a);var o=a.color;l(o),e(o.hue,o.saturation,o.luminance,o.alpha,a),u.isChecked()||n()}),u=a(function(){u.isChecked()?(s.hide(),u.uncheck(),p=!1):(s.show(),u.check(),p=!0)});u.setColor(0,0,0,1),u.addClass(d+"-previewButton");var s=r(function(n,t,a,o){u.setColor(n,t,a,o),c.setColor(n,t,a,o),e(n,t,a,o,m)}),h=i(d+"-secondLayer");h.appendChild(c.element),h.appendChild(u.element);var f=i(d+"-content");f.appendChild(s.element),f.appendChild(h);var v=i(d);v.appendChild(f);var p=!1,m=c.blackButton;return{blackButton:c.blackButton,element:v,whiteButton:c.whiteButton,hide:function(){s.hide(),f.classList.remove("visible")},select:function(e){m=e,c.select(e),l(e.color)},show:function(){p&&s.show(),f.classList.add("visible")}}}function v(e,n){function t(){d.clearRect(0,0,l.width,l.height),d.beginPath(),d.arc(l.width/2,l.height/2,(f+1)/2,0,2*Math.PI),d.fill()}var a="ParamsPanel",o=1,r=48,l=document.createElement("canvas");l.width=l.height=r+4,l.className=a+"-previewCanvas";var d=l.getContext("2d"),c=C(function(n){f=o+n*r,e(f),t()},n);c.addClass(a+"-slider");var u=i(a+"-content");u.appendChild(c.element),u.appendChild(l);var s=i(a);s.appendChild(u);var h=!1,f=o;return{element:s,hide:function(){c.abortTouch(),u.classList.remove("visible")},setColor:function(e,n,t){d.fillStyle="hsl("+e+", "+n+"%, "+t+"%)",h=!0},setSize:function(e){f=e,h=!0},show:function(){h&&(t(),h=!1,c.setRatio((f-o)/(r-o))),u.classList.add("visible")}}}function p(e,n){function t(t,a){!function(e,o,i){n.operate(function(n){n.lineWidth=e,n.fillStyle=i,n.beginPath(),n.arc(t,a,o,0,2*Math.PI),n.fill()})}(e,p,B)}function a(e){if(e.preventDefault(),f)f=!1;else{h=!0;var n=g.getBoundingClientRect();u=e.clientX-n.left,s=e.clientY-n.top,t(u,s)}}function o(){f?f=!1:h=!1}function i(e){if(f)f=!1;else if(h){var n=g.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top;r(u,s,t,a),u=t,s=a}}function r(t,a,o,i){!function(e,r){n.operate(function(n){n.lineWidth=e,n.strokeStyle=r,n.beginPath(),n.moveTo(t,a),n.lineTo(o,i),n.stroke()})}(e,B)}function l(e){f=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete v[n[t].identifier]}function d(e){f=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),t=e.changedTouches,a=0;a<t.length;a++){var o=t[a],i=v[o.identifier];if(i){var l=o.clientX-n.left,d=o.clientY-n.top;r(i.x,i.y,l,d),i.x=l,i.y=d}}}function c(e){f=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),a=e.changedTouches,o=0;o<a.length;o++){var i=a[o],r=i.clientX-n.left,l=i.clientY-n.top;t(r,l),v[i.identifier]={x:r,y:l}}}var u,s,h=!1,f=!1,v={},p=e/2,m=!1,g=n.canvas,C=0,b=0,k=0,L=1,B="hsla(0, 0%, 0%, 1)";return{disable:function(){m&&(g.removeEventListener("mousedown",a),g.removeEventListener("mousemove",i),g.removeEventListener("mouseup",o),g.removeEventListener("touchstart",c),g.removeEventListener("touchmove",d),g.removeEventListener("touchend",l),m=!1)},enable:function(){m||(g.addEventListener("mousedown",a),g.addEventListener("mousemove",i),g.addEventListener("mouseup",o),g.addEventListener("touchstart",c),g.addEventListener("touchmove",d),g.addEventListener("touchend",l),m=!0)},setColor:function(e,n,t,a){C=e,b=n,k=t,L=a,B="hsla("+C+", "+b+"%, "+k+"%, "+L+")"},setSize:function(n){e=n,p=e/2}}}function m(e,n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var o=(n-e.width)/2,i=(t-e.height)/2,r=a.getContext("2d");r.drawImage(e,o,i);var l=document.createElement("a");l.href=a.toDataURL("image/png"),l.download="picture.png",l.style.position="absolute",l.style.top=l.style.left=0,document.body.appendChild(l),l.click(),document.body.removeChild(l)}function g(e,n){function t(){var e="hsl("+a+", 100%, "+o+"%)",n="hsl("+a+", 0%, "+o+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";l.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",d.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var a=0,o=0,r="SaturationSlider",l=i(r+"-portraitBar"),d=i(r+"-landscapeBar"),c=C(function(n){e(100*n)},n);return c.addClass(r),c.barElement.appendChild(l),c.barElement.appendChild(d),t(),{abortTouch:c.abortTouch,element:c.element,setHue:function(e){a=e,t()},setLuminance:function(e){o=e,t()},setSaturation:function(e){c.setRatio(e/100)}}}function C(e,n){function t(t){function i(n){var t=h.getBoundingClientRect(),o=u.offsetHeight;if(innerWidth>innerHeight){var i=h.offsetHeight;c=1-(n.clientY-t.top-o/2)/i}else{var r=h.offsetWidth;c=(n.clientX-t.left-o/2)/r}c=Math.max(0,Math.min(1,c)),a(),e(c)}function r(){endSlide(),n()}function f(e){l?l=!1:i(e)}function v(){l?l=!1:r()}function p(e){l=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===d){e.preventDefault(),r();break}}function m(e){l=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===d){e.preventDefault(),i(a);break}}}endSlide=function(){o=!1,d=null,s.remove("active"),removeEventListener("mousemove",f),removeEventListener("mouseup",v),removeEventListener("touchmove",m),removeEventListener("touchend",p)},o=!0,i(t),s.add("active"),addEventListener("mousemove",f),addEventListener("mouseup",v),addEventListener("touchmove",m),addEventListener("touchend",p)}function a(){u.style.top=100*(1-c)+"%",u.style.left=100*c+"%"}var o=!1,r="Slider",l=!1,d=null,c=0,u=i(r+"-handle"),s=u.classList,h=i(r+"-handleWrapper");h.appendChild(u);var f=i(r+"-bar"),v=i(r);return v.appendChild(f),v.appendChild(h),v.addEventListener("mousedown",function(e){e.preventDefault(),l?l=!1:t(e)}),v.addEventListener("touchstart",function(e){if(l=!0,null===d){e.preventDefault();var n=e.changedTouches[0];d=n.identifier,t(n)}}),a(),{barElement:f,element:v,abortTouch:function(){o&&endSlide()},addClass:function(e){v.classList.add(e)},setRatio:function(e){c=e,a()}}}function b(e,t){var a=n(e,t),o="ToolButton",r=i(o+"-opaque"),l=i(o+"-color");l.appendChild(r);var d=i(o+"-transparency");d.style.backgroundImage="url(images/color-background.svg)",d.appendChild(l);var c=a.element,u=c.classList;return a.contentElement.appendChild(d),{addClass:a.addClass,check:a.check,element:c,isChecked:a.isChecked,uncheck:a.uncheck,mark:function(){u.add("marked")},setColor:function(e,n,t,a){var o=e+", "+n+"%, "+t+"%",i="hsla("+o+", "+a+")";l.style.background=i;var d="hsl("+o+")";r.style.background=d},unmark:function(){u.remove("marked")}}}function k(e){function n(){function n(){removeEventListener("mouseup",t),removeEventListener("touchend",a),d.remove("active"),clearInterval(o)}function t(){i?i=!1:n()}function a(e){i=!0;for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===l&&(l=null,n())}var i=!1;addEventListener("touchend",a),addEventListener("mouseup",t),d.add("active"),o=setInterval(e,50),e()}var t=i("Button-content");t.style.backgroundImage="url(images/undo.svg)";var a=i("Button UndoButton disabled");a.appendChild(t),a.addEventListener("mousedown",function(e){e.preventDefault(),r?r=!1:n()}),a.addEventListener("touchstart",function(e){r=!0,null===l&&(e.preventDefault(),l=e.changedTouches[0].identifier,n())});var o,r=!1,l=null,d=a.classList;return{element:a,disable:function(){d.add("disabled")},enable:function(){d.remove("disabled")}}}!function(){var e=i("Main-progress"),n=i("Main-loadBar");n.appendChild(e),document.body.appendChild(n);var t=0,a=["pencil","eraser","palette","params","undo","burger"];a.forEach(function(o){var i=new Image;i.src="images/"+o+".svg",i.onload=i.onerror=i.onabort=function(){if(t++,e.style.width=t/a.length*100+"%",t==a.length){var o=s();document.body.removeChild(n),document.body.appendChild(o.element)}}})}()}();