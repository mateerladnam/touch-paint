!function(){function e(e,n){function t(){var e=r+", "+c+"%, "+u+"%",n="hsl("+e+")",t="hsla("+e+", 0)",a="url(images/color-background.svg)",l="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";o.style.backgroundImage="linear-gradient("+l+"), linear-gradient(90deg, "+t+", "+n+"), "+a,i.style.backgroundImage="linear-gradient(90deg, "+l+"), linear-gradient("+n+", "+t+"), "+a}var a="AlphaSlider",o=l(a+"-portraitBar"),i=l(a+"-landscapeBar"),r=0,c=0,u=0,d=D(function(n){e(n),t()},n);return d.setRatio(1),d.addClass(a),d.barElement.appendChild(o),d.barElement.appendChild(i),t(),{abortTouch:d.abortTouch,element:d.element,setAlpha:d.setRatio,setHue:function(e){r=e,t()},setLuminance:function(e){u=e,t()},setSaturation:function(e){c=e,t()}}}function n(e,n){function t(){s.addEventListener("mousedown",i),s.addEventListener("touchstart",c)}function o(){n(),p.add("active"),clearTimeout(h),h=setTimeout(function(){p.remove("active")},100)}function i(e){0===e.button&&(e.preventDefault(),u?u=!1:o())}function r(e){d.style.backgroundImage="url(images/"+e+".svg)"}function c(e){u=!0,e.preventDefault(),o()}var u=!1,d=l("Button-content"),s=l("Button");s.appendChild(d);var h,v=a(s),f=!1,p=s.classList;return r(e),t(),{contentElement:d,element:s,hideExpandable:v.hide,setIcon:r,showExpandable:v.show,addClass:function(e){p.add(e)},check:function(){p.add("checked"),f=!0},disable:function(){p.add("disabled"),s.removeEventListener("mousedown",i),s.removeEventListener("touchstart",c)},enable:function(){p.remove("disabled"),t()},isChecked:function(){return f},uncheck:function(){p.remove("checked"),f=!1}}}function t(e){function n(n){var s=d.getBoundingClientRect(),h=Math.floor(n.clientX-s.left),v=Math.floor(n.clientY-s.top),f=d.getContext("2d"),p=f.getImageData(h,v,1,1),m=p.data,g=m[0],C=m[1],b=m[2];!function(n,r,l,c){var u=1-c,s=n*c,f=r*c,p=l*c;e.operate(function(e){function c(e,n){if(!(i>e||e==a||t>n||n==o)){if(B[n]){if(B[n][e])return}else B[n]=Object.create(null);B[n][e]=!0,w.push([e,n])}}var m=d.width,k=d.height,E=e.getImageData(0,0,m,k),L=E.data,w=[],B=Object.create(null);c(h,v);for(var y=Object.create(null),x=20;w.length;){var T=w.shift(),S=T[0],D=T[1],M=4*(D*m+S),P=M+1,I=P+1,z=L[M],R=L[P],H=L[I],A=Math.abs(g-z),N=Math.abs(C-R),W=Math.abs(b-H),X=Math.max(A,N,W);X>x?(y[D]||(y[D]=Object.create(null)),y[D][S]=!0):(L[M]=s+z*u,L[P]=f+R*u,L[I]=p+H*u,c(S+1,D),c(S-1,D),c(S,D+1),c(S,D-1))}for(var Y in y){var U=y[Y];for(var O in U){var M=4*(Y*m+Number(O)),P=M+1,I=P+1,z=L[M],R=L[P],H=L[I];L[M]=((z+n)/2+s+z*u)/2,L[P]=((R+r)/2+f+R*u)/2,L[I]=((H+l)/2+p+z*u)/2}}e.putImageData(E,0,0)},200)}(r,l,c,u)}var t,a,o,i,r=0,l=0,c=0,u=1,d=e.canvas,s=!1;return{disable:function(){s&&(d.removeEventListener("mousedown",n),s=!1)},enable:function(){s||(d.addEventListener("mousedown",n),s=!0)},setColor:function(e,n,t,a){var o=h(e,n,t);r=o.r,l=o.g,c=o.b,u=a},resize:function(e,n){var r=d.width/2,l=d.height/2,c=e/2,u=n/2;t=Math.floor(l-u),a=Math.floor(r+c),o=Math.ceil(l+u),i=Math.ceil(r-c)}}}function a(e){var n=l("ButtonExpandable-top");n.style.backgroundImage="url(images/top-expandable.svg)";var t=l("ButtonExpandable-left");t.style.backgroundImage="url(images/left-expandable.svg)";var a=!1;return{hide:function(){a!==!1&&(a=!1,e.removeChild(n),e.removeChild(t))},show:function(){a!==!0&&(a=!0,e.appendChild(n),e.appendChild(t))}}}function o(){var e="Canvas",n=Math.max(screen.width,screen.height),t=document.createElement("canvas");t.className=e+"-canvas",t.width=t.height=n,t.style.left=t.style.top=-n/2+"px";var a=t.getContext("2d");a.lineCap="round",a.fillStyle="#fff",a.fillRect(0,0,n,n);var o=l(e+"-center");o.appendChild(t);var i=l(e);i.appendChild(o);var r,c,u=[],d=128,s=[];return{canvas:t,element:i,onUndoAvailable:function(e){r=e},onUndoUnavailable:function(e){c=e},operate:function(e,t){u.push({operation:e,timeout:t}),1==u.length&&r(),e(a);var o=u.length-d;if(!(0>o)){var i=Math.floor(o/d);if(!s[i]){var l=document.createElement("canvas");l.width=l.height=n;var c=l.getContext("2d");c.lineCap="round",i?c.drawImage(s[i-1],0,0):(c.fillStyle="#fff",c.fillRect(0,0,n,n)),s.push(l);for(var h=o;o+d>h;h++)u[h].operation(c)}}},undo:function(){if(a.globalAlpha=1,s.length?a.drawImage(s[s.length-1],0,0):(a.fillStyle="#fff",a.fillRect(0,0,n,n)),!u.length)return 50;for(var e=u.pop(),t=s.length*d,o=t;o<u.length;o++)u[o].operation(a);return s.length*d>u.length&&s.pop(),u.length||c(),e.timeout}}}function i(e){function n(){e(),v.add("active"),clearTimeout(d),d=setTimeout(function(){v.remove("active")},100)}var t=!1,o="ColorButton",i=l(o+"-opaque"),r=l(o+"-color");r.appendChild(i);var c=l(o+"-transparency Button-content");c.appendChild(r),c.style.backgroundImage="url(images/color-background.svg)";var u=l("Button");u.appendChild(c),u.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),t?t=!1:n())}),u.addEventListener("touchstart",function(e){t=!0,e.preventDefault(),n()});var d,s=a(u),h=!1,v=u.classList,f={};return{color:f,element:u,hideExpandable:s.hide,showExpandable:s.show,addClass:function(e){v.add(e)},check:function(){v.add("checked"),h=!0},isChecked:function(){return h},mark:function(){v.add("marked")},setColor:function(e,n,t,a){f.hue=e,f.saturation=n,f.luminance=t,f.alpha=a;var o=e+", "+n+"%, "+t+"%",l="hsla("+o+", "+a+")";r.style.backgroundColor=l;var c="hsl("+o+")";i.style.backgroundColor=c},uncheck:function(){v.remove("checked"),h=!1},unmark:function(){v.remove("marked")}}}function r(e){function n(n,r,l,c){var u=i(function(){t(u),e(u)});return u.setColor(n,r,l,1),u.addClass(o+"-colorButton"),u.addClass(o+"-"+c+"Button"),a.push(u),u}function t(e){w.uncheck(),e.check(),w=e,y.setColor=e.setColor}var a=[],o="ColorButtonsPanel",r=n(0,0,0,"black");r.check(),r.mark();var c=n(0,0,40,"darkGrey"),u=n(0,0,70,"lightGrey"),d=n(0,0,100,"white");d.mark();var s=n(232,100,50,"blue"),h=n(210,100,80,"skyBlue"),v=n(114,100,33,"darkGreen"),f=n(115,87,50,"green"),p=n(4,100,47,"red"),m=n(60,100,50,"yellow"),g=n(30,100,33,"brown"),C=n(32,100,50,"orange"),b=n(306,100,33,"violet"),k=n(312,100,83,"pink"),E=n(30,55,65,"darkSkin"),L=n(31,55,75,"lightSkin"),w=r,B=l(o);B.appendChild(r.element),B.appendChild(c.element),B.appendChild(u.element),B.appendChild(d.element),B.appendChild(s.element),B.appendChild(h.element),B.appendChild(v.element),B.appendChild(f.element),B.appendChild(p.element),B.appendChild(m.element),B.appendChild(g.element),B.appendChild(C.element),B.appendChild(b.element),B.appendChild(k.element),B.appendChild(E.element),B.appendChild(L.element);var y={blackButton:r,element:B,select:t,whiteButton:d,setColor:w.setColor};return y}function l(e){var n=document.createElement("div");return n.className=e,n}function c(n){function t(){d.abortTouch(),s.abortTouch(),h.abortTouch()}function a(){n(o,i,r,c)}var o=0,i=0,r=0,c=1,u="EditColorPanel",d=v(function(e){o=e,a(),s.setHue(o),h.setHue(o),f.setHue(o)},a),s=S(function(e){i=e,a(),h.setSaturation(i),f.setSaturation(i)},a),h=p(function(e){r=e,a(),s.setLuminance(r),f.setLuminance(r)},a),f=e(function(e){c=e,a()},a),m=l(u);return m.appendChild(d.element),m.appendChild(s.element),m.appendChild(h.element),m.appendChild(f.element),{element:m,hide:function(){t(),f.abortTouch(),m.classList.remove("visible")},setColor:function(e,n,a,l){t(),o=e,i=n,r=a,c=l,d.setHue(o),s.setHue(o),s.setSaturation(i),s.setLuminance(r),h.setHue(o),h.setSaturation(i),h.setLuminance(r),f.setHue(o),f.setSaturation(i),f.setLuminance(r),f.setAlpha(c)},show:function(){m.classList.add("visible")}}}function u(e,n){function t(t){var o={};i(o,t);var r={x:o.x,y:o.y},l={color:b,endPoint:r,size:e,startPoint:o,end:function(){d.splice(d.indexOf(l),1),u(),n.operate(function(e){a(e,l)},200)},move:function(e){i(r,e),u()}};return d.push(l),u(),l}function a(e,n){var t=n.startPoint,a=t.x,o=t.y,i=n.endPoint,r=i.x,l=i.y,c=(r-a)/2,u=(l-o)/2,d=.5522848,s=c*d,h=u*d,v=a+c,f=o+u;e.beginPath(),e.moveTo(a,f),e.bezierCurveTo(a,f-h,v-s,o,v,o),e.bezierCurveTo(v+s,o,r,f-h,r,f),e.bezierCurveTo(r,f+h,v+s,l,v,l),e.bezierCurveTo(v-s,l,a,f+h,a,f),e.lineJoin="round",e.lineWidth=n.size,e.strokeStyle=n.color,e.stroke()}function o(e){function n(e){o.move(e),u()}function a(){o.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var o=t(e);addEventListener("mousemove",n),addEventListener("mouseup",a)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=a.identifier,i=h[o];i&&(i.end(),delete h[o])}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=h[a.identifier];o&&o.move(a)}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++){var o=n[a];h[o.identifier]=t(o)}}function u(){E.clearRect(0,0,k.width,k.height),d.forEach(function(e){a(E,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,p=0,m=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",k=document.createElement("canvas");k.className="EllipseTool-overlayCanvas",k.width=f.width,k.height=f.height,k.style.top=f.style.top,k.style.left=f.style.left;var E=k.getContext("2d");return f.parentNode.appendChild(k),{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",c),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",c),f.addEventListener("touchmove",l),f.addEventListener("touchend",r),v=!0)},setColor:function(e,n,t,a){p=e,m=n,g=t,C=a,b="hsla("+p+", "+m+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function d(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){var e=new Image;e.src=a.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},a.onabort=function(){},a.onerror=function(){},o.removeChild(e),t()}),o.appendChild(e)}var a=l("Button-content");a.style.backgroundImage="url(images/"+e+".svg)";var o=l("Button");return o.appendChild(a),t(),{element:o,addClass:function(e){o.classList.add(e)}}}function s(e,t,a){var o="FilePanel",i=n("file",e);i.addClass(o+"-newButton");var r=d("open",t);r.addClass(o+"-openButton");var c=n("save",a);c.addClass(o+"-saveButton");var u=l(o+"-content");u.appendChild(i.element),u.appendChild(r.element),u.appendChild(c.element);var s=l(o);s.appendChild(u);var h=u.classList;return{element:s,hide:function(){h.remove("visible")},show:function(){h.add("visible")}}}function h(e,n,t){var a,o,i,r,l,c;return isFinite(e)||(e=0),isFinite(n)||(n=0),isFinite(t)||(t=0),e/=60,0>e&&(e=6- -e%6),e%=6,n=Math.max(0,Math.min(1,n/100)),t=Math.max(0,Math.min(1,t/100)),l=(1-Math.abs(2*t-1))*n,c=l*(1-Math.abs(e%2-1)),1>e?(a=l,o=c,i=0):2>e?(a=c,o=l,i=0):3>e?(a=0,o=l,i=c):4>e?(a=0,o=c,i=l):5>e?(a=c,o=0,i=l):(a=l,o=0,i=c),r=t-l/2,a=Math.round(255*(a+r)),o=Math.round(255*(o+r)),i=Math.round(255*(i+r)),{r:a,g:o,b:i}}function v(e,n){var t=D(function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function f(e,n){function t(t){var o={};i(o,t);var r={x:o.x,y:o.y},l={color:b,endPoint:r,size:e,startPoint:o,end:function(){d.splice(d.indexOf(l),1),u(),n.operate(function(e){a(e,l)},200)},move:function(e){i(r,e),u()}};return d.push(l),u(),l}function a(e,n){var t=n.startPoint,a=n.endPoint;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(a.x,a.y),e.strokeStyle=n.color,e.lineCap="round",e.lineWidth=n.size,e.stroke()}function o(e){function n(e){o.move(e),u()}function a(){o.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var o=t(e);addEventListener("mousemove",n),addEventListener("mouseup",a)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=a.identifier,i=h[o];i&&(i.end(),delete h[o])}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=h[a.identifier];o&&o.move(a)}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++){var o=n[a];h[o.identifier]=t(o)}}function u(){E.clearRect(0,0,k.width,k.height),d.forEach(function(e){a(E,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,p=0,m=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",k=document.createElement("canvas");k.className="LineTool-overlayCanvas",k.width=f.width,k.height=f.height,k.style.top=f.style.top,k.style.left=f.style.left;var E=k.getContext("2d");return f.parentNode.appendChild(k),{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",c),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",c),f.addEventListener("touchmove",l),f.addEventListener("touchend",r),v=!0)},setColor:function(e,n,t,a){p=e,m=n,g=t,C=a,b="hsla("+p+", "+m+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function p(e,n){function t(){var e="hsl("+a+", "+o+"%, 0%)",n="hsl("+a+", "+o+"%, 50%)",t="hsl("+a+", "+o+"%, 100%)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",c.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+t+", "+n+", "+e+")"}var a=0,o=0,i="LuminanceSlider",r=l(i+"-portraitBar"),c=l(i+"-landscapeBar"),u=D(function(n){e(100*n)},n);return u.addClass(i),u.barElement.appendChild(r),u.barElement.appendChild(c),t(),{abortTouch:u.abortTouch,element:u.element,setHue:function(e){a=e,t()},setLuminance:function(e){u.setRatio(e/100)},setSaturation:function(e){o=e,t()}}}function m(e){var n="MainBar",t=l(n+"-alternativeBar");t.appendChild(e.element);var a=l(n+"-bar"),o=l(n+"-scroll");o.appendChild(a),o.appendChild(t);var i=l(n);i.appendChild(o);var r=o.classList;return{element:i,addButton:function(e){a.appendChild(e.element)},show:function(){i.classList.add("visible")},slide:function(){r.add("slide")},unslide:function(){r.remove("slide")}}}function g(){function e(){i(),r(),a(),rn()}function a(){K.hide(),nn.uncheck()}function i(){X.hide(),$.uncheck()}function r(){J.hide(),_.uncheck()}function c(){Z.uncheck(),V.disable()}function d(){Q.uncheck(),Q.hideExpandable(),G.disable()}function h(){Z.check(),V.enable()}function v(){Q.check(),Q.showExpandable(),G.enable()}function p(){W.hide(),e(),d(),h(),J.setSize(R),Z.mark(),Q.unmark(),D(Z,[V]),N=p}function g(){e(),c(),v(),J.setSize(z),Q.mark(),Z.unmark(),D(Q,[Y,U,O,F,j]),N=g}function L(e,n,t,a,o){o==Q.colorButton&&S(e,n,t,a),o==Z.colorButton&&x(e,n,t,a),J.setColor(e,n,t)}function x(e,n,t,a){V.setColor(e,n,t,a),Z.setColor(e,n,t,a)}function S(e,n,t,a){G.setColor(e,n,t,a),Q.setColor(e,n,t,a)}function D(e,n){var t=e.colorButton;X.select(t);var a=t.color,o=a.hue,i=a.saturation,r=a.luminance;n.forEach(function(e){e.setColor(o,i,r,a.alpha)}),J.setColor(o,i,r)}var z=4,R=8,H="MainPanel",A=o(),N=g,W=P(function(){Q.setIcon("pencil"),G.disable(),G=Y,G.enable(),_.enable()},function(){Q.setIcon("line"),G.disable(),G=U,G.enable(),_.enable()},function(){Q.setIcon("ellipse"),G.disable(),G=O,G.enable(),_.enable()},function(){Q.setIcon("rectangle"),G.disable(),G=F,G.enable(),_.enable()},function(){Q.setIcon("bucket"),G.disable(),G=j,G.enable(),_.disable()}),X=b(L,function(){i(),a(),N()},function(e){if(N==g){var n=Q.colorButton;n!=Z.colorButton&&n.unmark(),Q.colorButton=e,e.mark()}else{var n=Z.colorButton;n!=Q.colorButton&&n.unmark(),Z.colorButton=e,e.mark()}},function(e){var n=e.color;an.setColor(n.hue,n.saturation,n.luminance,1),q.enable(),X.hide(),on.slide()}),Y=E(z,A),U=f(z,A),O=u(z,A),F=y(z,A),j=t(A),V=E(R,A),G=Y,q=B(A,function(e,n,t){an.setColor(e,n,t,1)}),J=k(function(e){N==g?(z=e,Y.setSize(e),U.setSize(e),O.setSize(e),F.setSize(e)):(R=e,V.setSize(e))},function(){N()});J.setSize(z);var K=s(function(){A.operate(function(e){var n=e.canvas.width;e.fillStyle="#fff",e.globalAlpha=1,e.fillRect(0,0,n,n)},200),N()},function(e){A.operate(function(n){var t=A.element;C(n,e,t.offsetWidth,t.offsetHeight)},200),N()},function(){var e=A.element,n=e.offsetWidth,t=e.offsetHeight;T(A.canvas,n,t),N()}),Q=M("pencil",function(){Q.isChecked()&&(W.isVisible()?W.hide():W.show()),g()});Q.addClass(H+"-primaryToolButton"),Q.colorButton=X.blackButton;var Z=M("eraser",p);Z.addClass(H+"-eraserButton"),Z.colorButton=X.whiteButton,x(0,0,100,1),S(0,0,0,1);var $=n("palette",function(){$.isChecked()?N():(d(),c(),W.hide(),r(),a(),rn(),X.show(),$.check())});$.addClass(H+"-paletteButton"),$.showExpandable();var _=n("params",function(){_.isChecked()?N():(d(),c(),W.hide(),i(),a(),rn(),J.show(),_.check())});_.addClass(H+"-paramsButton"),_.showExpandable();var en=I(A.undo);A.onUndoAvailable(en.enable),A.onUndoUnavailable(en.disable);var nn=n("burger",function(){nn.isChecked()?N():(d(),c(),W.hide(),i(),r(),rn(),K.show(),nn.check())});nn.addClass(H+"-fileButton"),nn.showExpandable();var tn=l(H+"-content");tn.appendChild(A.element),tn.appendChild(W.element),tn.appendChild(X.element),tn.appendChild(J.element),tn.appendChild(K.element);var an=w(function(e,n,t){X.pickColor(e,n,t),L(e,n,t,1,X.getActiveButton())},function(){q.disable(),rn(),X.isEditVisible()?X.show():N()}),on=m(an);on.addButton(Q),on.addButton(Z),on.addButton($),on.addButton(_),on.addButton(en),on.addButton(nn);var rn=on.unslide,ln=l(H);return ln.appendChild(tn),ln.appendChild(on.element),{element:ln,resize:function(){var e=A.element;j.resize(e.offsetWidth,e.offsetHeight)},show:function(){g(),on.show()}}}function C(e,n,t,a){var o,i,r=e.canvas,l=t/a,c=n.width/n.height;l>c?(o=t,i=o/c):(i=a,o=i*c);var u=(r.width-o)/2,d=(r.height-i)/2;e.globalAlpha=1,e.drawImage(n,u,d,o,i)}function b(e,n,t,a){function o(e){var n=e.hue,t=e.saturation,a=e.luminance,o=e.alpha;s.setColor(n,t,a,o),h.setColor(n,t,a,o)}var u="PalettePanel",d=r(function(a){b=a,t(a);var i=a.color;o(i),e(i.hue,i.saturation,i.luminance,i.alpha,a),s.isChecked()||n()}),s=i(function(){g&&(s.isChecked()?(h.hide(),s.uncheck(),C=!1):(h.show(),s.check(),C=!0))});s.setColor(0,0,0,1),s.addClass(u+"-previewButton"),s.showExpandable();var h=c(function(n,t,a,o){s.setColor(n,t,a,o),d.setColor(n,t,a,o),e(n,t,a,o,b)}),v=L(function(){a(b)}),f=l(u+"-secondLayer");f.appendChild(d.element),f.appendChild(s.element),f.appendChild(v.element);var p=l(u+"-content");p.appendChild(h.element),p.appendChild(f);var m=l(u);m.appendChild(p);var g=!1,C=!1,b=d.blackButton;return{blackButton:d.blackButton,element:m,whiteButton:d.whiteButton,getActiveButton:function(){return b},hide:function(){g&&(h.hide(),p.classList.remove("visible"),g=!1)},isEditVisible:function(){return C},select:function(e){b=e,d.select(e),o(e.color)},pickColor:function(e,n,t){var a=s.color.alpha;h.setColor(e,n,t,a),s.setColor(e,n,t,a),d.setColor(e,n,t,a)},show:function(){g||(C&&h.show(),p.classList.add("visible"),g=!0)}}}function k(e,n){function t(){c.clearRect(0,0,r.width,r.height),c.beginPath(),c.arc(r.width/2,r.height/2,(v+1)/2,0,2*Math.PI),c.fill()}var a="ParamsPanel",o=1,i=48,r=document.createElement("canvas");r.width=r.height=i+4,r.className=a+"-previewCanvas";var c=r.getContext("2d"),u=D(function(n){v=o+n*i,e(v),t()},n);u.addClass(a+"-slider");var d=l(a+"-content");d.appendChild(u.element),d.appendChild(r);var s=l(a);s.appendChild(d);var h=!1,v=o;return{element:s,hide:function(){u.abortTouch(),d.classList.remove("visible")},setColor:function(e,n,t){c.fillStyle="hsl("+e+", "+n+"%, "+t+"%)",h=!0},setSize:function(e){v=e,h=!0},show:function(){h&&(t(),h=!1,u.setRatio((v-o)/(i-o))),d.classList.add("visible")}}}function E(e,n){function t(t,a){!function(e,o,i){n.operate(function(n){n.lineWidth=e,n.fillStyle=i,n.beginPath(),n.arc(t,a,o,0,2*Math.PI),n.fill()},50)}(e,d,g)}function a(e){function n(){c?c=!1:(removeEventListener("mousemove",a),removeEventListener("mouseup",n))}function a(e){if(c)c=!1;else{var n=h.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top;o(r,l,t,a),r=t,l=a}}if(0===e.button)if(e.preventDefault(),c)c=!1;else{var i=h.getBoundingClientRect(),r=e.clientX-i.left,l=e.clientY-i.top;t(r,l),addEventListener("mousemove",a),addEventListener("mouseup",n)}}function o(t,a,o,i){!function(e,r){n.operate(function(n){n.lineWidth=e,n.strokeStyle=r,n.beginPath(),n.moveTo(t,a),n.lineTo(o,i),n.stroke()},50)}(e,g)}function i(e){c=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete u[n[t].identifier]}function r(e){c=!0,e.preventDefault();for(var n=h.getBoundingClientRect(),t=e.changedTouches,a=0;a<t.length;a++){var i=t[a],r=u[i.identifier];if(r){var l=i.clientX-n.left,d=i.clientY-n.top;o(r.x,r.y,l,d),r.x=l,r.y=d}}}function l(e){c=!0,e.preventDefault();for(var n=h.getBoundingClientRect(),a=e.changedTouches,o=0;o<a.length;o++){var i=a[o],r=i.clientX-n.left,l=i.clientY-n.top;t(r,l),u[i.identifier]={x:r,y:l}}}var c=!1,u={},d=e/2,s=!1,h=n.canvas,v=0,f=0,p=0,m=1,g="hsla(0, 0%, 0%, 1)";return{disable:function(){s&&(h.removeEventListener("mousedown",a),h.removeEventListener("touchstart",l),h.removeEventListener("touchmove",r),h.removeEventListener("touchend",i),s=!1)},enable:function(){s||(h.addEventListener("mousedown",a),h.addEventListener("touchstart",l),h.addEventListener("touchmove",r),h.addEventListener("touchend",i),s=!0)},setColor:function(e,n,t,a){v=e,f=n,p=t,m=a,g="hsla("+v+", "+f+"%, "+p+"%, "+m+")"},setSize:function(n){e=n,d=e/2}}}function L(e){var t=n("pick",e);return t.addClass("PickButton"),t}function w(e,t){var a="PickPanel",o=i(function(){var n=o.color;e(n.hue,n.saturation,n.luminance),t()});o.addClass(a+"-colorButton");var r=n("cancel",t);r.addClass(a+"-cancelButton");var c=l(a);return c.appendChild(o.element),c.appendChild(r.element),{element:c,setColor:o.setColor}}function B(e,n){function t(e){var n=a(e);r(n[0],n[1])}function a(e){var n=f.getBoundingClientRect(),t=Math.floor(e.clientX-n.left),a=Math.floor(e.clientY-n.top);return[t,a]}function o(e){function n(e){e.preventDefault(),s?s=!1:i(e)}function a(e){e.preventDefault(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}0===e.button&&(e.preventDefault(),s?s=!1:(t(e),addEventListener("mousemove",n),addEventListener("mouseup",a)))}function i(e){var n=a(e),t=n[0],o=n[1];t>=0&&p>t&&o>=0&&m>o&&r(t,o)}function r(e,t){var a=4*(e+t*p),o=x(d[a],d[a+1],d[a+2]);n(o.hue,o.saturation,o.luminance)}function l(e){e.preventDefault(),s=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===h){h=null;break}}function c(e){e.preventDefault(),s=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===h){i(a);break}}}function u(e){if(e.preventDefault(),s=!0,null===h){var n=e.changedTouches[0];h=n.identifier,t(n)}}var d,s=!1,h=null,v=!1,f=e.canvas,p=f.width,m=f.height,g=f.getContext("2d");return{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",u),removeEventListener("touchmove",c),removeEventListener("touchend",l),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",u),addEventListener("touchmove",c),addEventListener("touchend",l),v=!0,d=g.getImageData(0,0,p,m).data)}}}function y(e,n){function t(t){var o={};i(o,t);var r={x:o.x,y:o.y},l={color:b,endPoint:r,size:e,startPoint:o,end:function(){d.splice(d.indexOf(l),1),u(),n.operate(function(e){a(e,l)},200)},move:function(e){i(r,e),u()}};return d.push(l),u(),l}function a(e,n){var t=n.startPoint,a=t.x,o=t.y,i=n.endPoint;e.beginPath(),e.rect(a,o,i.x-a,i.y-o),e.strokeStyle=n.color,e.lineJoin="round",e.lineWidth=n.size,e.stroke()}function o(e){function n(e){o.move(e),u()}function a(){o.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",a)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var o=t(e);addEventListener("mousemove",n),addEventListener("mouseup",a)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=a.identifier,i=h[o];i&&(i.end(),delete h[o])}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t],o=h[a.identifier];o&&o.move(a)}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++){var o=n[a];h[o.identifier]=t(o)}}function u(){E.clearRect(0,0,k.width,k.height),d.forEach(function(e){a(E,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,p=0,m=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",k=document.createElement("canvas");k.className="RectangleTool-overlayCanvas",k.width=f.width,k.height=f.height,k.style.top=f.style.top,k.style.left=f.style.left;var E=k.getContext("2d");return f.parentNode.appendChild(k),{disable:function(){v&&(f.removeEventListener("mousedown",o),f.removeEventListener("touchstart",c),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",o),f.addEventListener("touchstart",c),f.addEventListener("touchmove",l),f.addEventListener("touchend",r),v=!0)},setColor:function(e,n,t,a){p=e,m=n,g=t,C=a,b="hsla("+p+", "+m+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function x(e,n,t){var a,o,i,r,l,c;if(e/=255,n/=255,t/=255,a=Math.max(e,n,t),o=Math.min(e,n,t),l=(a+o)/2,a==o)i=r=0;else{switch(c=a-o,r=l>.5?c/(2-a-o):c/(a+o),a){case e:i=(n-t)/c+(t>n?6:0);break;case n:i=(t-e)/c+2;break;case t:i=(e-n)/c+4}i/=6}return i=Math.floor(360*i),r=Math.floor(100*r),l=Math.floor(100*l),{hue:i,saturation:r,luminance:l}}function T(e,n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var o=(n-e.width)/2,i=(t-e.height)/2,r=a.getContext("2d");r.drawImage(e,o,i);var l=document.createElement("a");l.href=a.toDataURL("image/png"),l.download="picture.png",l.style.position="absolute",l.style.top=l.style.left=0,document.body.appendChild(l),l.click(),document.body.removeChild(l)}function S(e,n){function t(){var e="hsl("+a+", 100%, "+o+"%)",n="hsl("+a+", 0%, "+o+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",c.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var a=0,o=0,i="SaturationSlider",r=l(i+"-portraitBar"),c=l(i+"-landscapeBar"),u=D(function(n){e(100*n)},n);return u.addClass(i),u.barElement.appendChild(r),u.barElement.appendChild(c),t(),{abortTouch:u.abortTouch,element:u.element,setHue:function(e){a=e,t()},setLuminance:function(e){o=e,t()},setSaturation:function(e){u.setRatio(e/100)}}}function D(e,n){function t(t){function i(n){var t=h.getBoundingClientRect(),o=d.offsetHeight;if(innerWidth>innerHeight){var i=h.offsetHeight;u=1-(n.clientY-t.top-o/2)/i}else{var r=h.offsetWidth;u=(n.clientX-t.left-o/2)/r}u=Math.max(0,Math.min(1,u)),a(),e(u)}function l(){v(),n()}function v(){o=!1,c=null,s.remove("active"),removeEventListener("mousemove",f),removeEventListener("mouseup",p),removeEventListener("touchmove",g),removeEventListener("touchend",m)}function f(e){r?r=!1:i(e)}function p(){r?r=!1:l()}function m(e){r=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===c){e.preventDefault(),l();break}}function g(e){r=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===c){e.preventDefault(),i(a);break}}}o=!0,i(t),s.add("active"),addEventListener("mousemove",f),addEventListener("mouseup",p),addEventListener("touchmove",g),addEventListener("touchend",m)}function a(){d.style.top=100*(1-u)+"%",d.style.left=100*u+"%"}var o=!1,i="Slider",r=!1,c=null,u=0,d=l(i+"-handle"),s=d.classList,h=l(i+"-handleWrapper");h.appendChild(d);var v=l(i+"-bar"),f=l(i);return f.appendChild(v),f.appendChild(h),f.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),r?r=!1:t(e))}),f.addEventListener("touchstart",function(e){if(r=!0,null===c){e.preventDefault();var n=e.changedTouches[0];c=n.identifier,t(n)}}),a(),{barElement:v,element:f,abortTouch:function(){o&&endSlide()},addClass:function(e){f.classList.add(e)},setRatio:function(e){u=e,a()}}}function M(e,t){var a=n(e,t),o="ToolButton",i=l(o+"-opaque"),r=l(o+"-color");r.appendChild(i);var c=l(o+"-transparency");c.style.backgroundImage="url(images/color-background.svg)",c.appendChild(r);var u=a.element,d=u.classList;return a.contentElement.appendChild(c),{addClass:a.addClass,check:a.check,element:u,hideExpandable:a.hideExpandable,isChecked:a.isChecked,setIcon:a.setIcon,showExpandable:a.showExpandable,uncheck:a.uncheck,mark:function(){d.add("marked")},setColor:function(e,n,t,a){var o=e+", "+n+"%, "+t+"%",l="hsla("+o+", "+a+")";r.style.background=l;var c="hsl("+o+")";i.style.background=c},unmark:function(){d.remove("marked")}}}function P(e,t,a,o,i){function r(){m.remove("visible"),g=!1}var c="ToolPanel",u=n("pencil",function(){d.uncheck(),s.uncheck(),h.uncheck(),v.uncheck(),u.check(),e(),r()});u.addClass(c+"-pencilButton"),u.check();var d=n("line",function(){u.uncheck(),s.uncheck(),h.uncheck(),v.uncheck(),d.check(),t(),r()});d.addClass(c+"-lineButton");var s=n("ellipse",function(){u.uncheck(),d.uncheck(),h.uncheck(),v.uncheck(),s.check(),a(),r()});s.addClass(c+"-ellipseButton");var h=n("rectangle",function(){u.uncheck(),d.uncheck(),s.uncheck(),v.uncheck(),h.check(),o(),r()});h.addClass(c+"-rectangleButton");var v=n("bucket",function(){u.uncheck(),d.uncheck(),s.uncheck(),h.uncheck(),v.check(),i(),r()});v.addClass(c+"-bucketButton");var f=l(c+"-content");f.appendChild(u.element),f.appendChild(d.element),f.appendChild(s.element),f.appendChild(h.element),f.appendChild(v.element);var p=l(c);p.appendChild(f);var m=f.classList,g=!1;return{element:p,hide:r,isVisible:function(){return g},show:function(){m.add("visible"),g=!0}}}function I(e){function n(){function n(){removeEventListener("mouseup",t),removeEventListener("touchend",a),c.remove("active"),clearTimeout(o)}function t(){l?l=!1:n()}function a(e){l=!0;for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===r&&(r=null,n())}function i(){o=setTimeout(i,e())}var l=!1;addEventListener("touchend",a),addEventListener("mouseup",t),c.add("active"),i()}var t=l("Button-content");t.style.backgroundImage="url(images/undo.svg)";var a=l("Button UndoButton disabled");a.appendChild(t),a.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),i?i=!1:n())}),a.addEventListener("touchstart",function(e){i=!0,null===r&&(e.preventDefault(),r=e.changedTouches[0].identifier,n())});var o,i=!1,r=null,c=a.classList;return{element:a,disable:function(){c.add("disabled")},enable:function(){c.remove("disabled")}}}!function(){var e=l("Main-horizontalProgress"),n=l("Main-verticalProgress"),t=l("Main-loadBar");t.appendChild(e),t.appendChild(n);var a=g(),o=document.body;o.appendChild(a.element),o.appendChild(t);var i=0,r=["bucket","burger","ellipse","eraser","left-expandable","line","palette","params","pencil","rectangle","top-expandable","undo"];r.forEach(function(l){var c=new Image;c.src="images/"+l+".svg",c.onload=c.onerror=c.onabort=function(){i++;var l=i/r.length*100+"%";e.style.width=l,n.style.height=l,i==r.length&&(a.show(),setTimeout(function(){t.classList.add("hidden"),setTimeout(function(){o.removeChild(t)},250)},250))}});var c=a.resize;addEventListener("resize",c),c()}()}();