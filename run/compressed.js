!function(){function e(e,n){function t(){var e=r+", "+c+"%, "+d+"%",n="hsl("+e+")",t="hsla("+e+", 0)",a="url(images/color-background.svg)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";o.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+t+", "+n+"), "+a,l.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+n+", "+t+"), "+a}var a="AlphaSlider",o=i(a+"-portraitBar"),l=i(a+"-landscapeBar"),r=0,c=0,d=0,u=g(function(n){e(n),t()},n);return u.setRatio(1),u.addClass(a),u.barElement.appendChild(o),u.barElement.appendChild(l),t(),{abortTouch:u.abortTouch,element:u.element,setAlpha:u.setRatio,setHue:function(e){r=e,t()},setLuminance:function(e){d=e,t()},setSaturation:function(e){c=e,t()}}}function n(e,n){function t(){n(),d.add("active"),clearTimeout(r),r=setTimeout(function(){d.remove("active")},100)}var a=!1,o=i("Button-content");o.style.backgroundImage="url(images/"+e+".svg)";var l=i("Button");l.appendChild(o),l.addEventListener("mousedown",function(e){e.preventDefault(),a?a=!1:t()}),l.addEventListener("touchstart",function(e){a=!0,e.preventDefault(),t()});var r,c=!1,d=l.classList;return{contentElement:o,element:l,addClass:function(e){d.add(e)},check:function(){d.add("checked"),c=!0},isChecked:function(){return c},uncheck:function(){d.remove("checked"),c=!1}}}function t(){var e="Canvas",n=Math.max(screen.width,screen.height),t=document.createElement("canvas");t.className=e+"-canvas",t.width=t.height=n,t.style.left=t.style.top=-n/2+"px";var a=t.getContext("2d");a.lineCap="round",a.fillStyle="#fff",a.fillRect(0,0,n,n);var o=i(e+"-center");o.appendChild(t);var l=i(e);l.appendChild(o);var r,c,d=[],u=128,s=[];return{canvas:t,element:l,onUndoAvailable:function(e){r=e},onUndoUnavailable:function(e){c=e},operate:function(e){d.push(e),1==d.length&&r(),e(a);var t=d.length-u;if(!(0>t)){var o=Math.floor(t/u);if(!s[o]){var i=document.createElement("canvas");i.width=i.height=n;var l=i.getContext("2d");l.lineCap="round",o?l.drawImage(s[o-1],0,0):(l.fillStyle="#fff",l.fillRect(0,0,n,n)),s.push(i);for(var c=t;t+u>c;c++)d[c](l)}}},undo:function(){if(a.globalAlpha=1,s.length?a.drawImage(s[s.length-1],0,0):(a.fillStyle="#fff",a.fillRect(0,0,n,n)),d.length){d.pop();for(var e=s.length*u,t=e;t<d.length;t++)d[t](a);s.length*u>d.length&&s.pop(),d.length||c()}}}}function a(e){function n(){e(),u.add("active"),clearTimeout(c),c=setTimeout(function(){u.remove("active")},100)}var t=!1,a="ColorButton",o=i(a+"-color"),l=i(a+"-transparency Button-content");l.appendChild(o),l.style.backgroundImage="url(images/color-background.svg)";var r=i("Button");r.appendChild(l),r.addEventListener("mousedown",function(e){e.preventDefault(),t?t=!1:n()}),r.addEventListener("touchstart",function(e){t=!0,e.preventDefault(),n()});var c,d=!1,u=r.classList,s={};return{color:s,element:r,addClass:function(e){u.add(e)},check:function(){u.add("checked"),d=!0},isChecked:function(){return d},mark:function(){u.add("marked")},setColor:function(e,n,t,a){s.hue=e,s.saturation=n,s.luminance=t,s.alpha=a;var i="hsla("+e+", "+n+"%, "+t+"%, "+a+")";o.style.backgroundColor=i},uncheck:function(){u.remove("checked"),d=!1},unmark:function(){u.remove("marked")}}}function o(e){function n(n,i,r,c){var d=a(function(){t(d),e(d)});return d.setColor(n,i,r,1),d.addClass(l+"-colorButton"),d.addClass(l+"-"+c+"Button"),o.push(d),d}function t(e){E.uncheck(),e.check(),E=e,y.setColor=e.setColor}var o=[],l="ColorButtonsPanel",r=n(0,0,0,"black");r.check(),r.mark();var c=n(0,0,40,"darkGrey"),d=n(0,0,70,"lightGrey"),u=n(0,0,100,"white");u.mark();var s=n(232,100,50,"blue"),h=n(210,100,80,"skyBlue"),f=n(114,100,33,"darkGreen"),v=n(115,87,50,"green"),p=n(4,100,47,"red"),m=n(60,100,50,"yellow"),g=n(30,100,33,"brown"),C=n(32,100,50,"orange"),b=n(306,100,33,"violet"),k=n(312,100,83,"pink"),L=n(30,55,65,"darkSkin"),B=n(31,55,75,"lightSkin"),E=r,w=i(l);w.appendChild(r.element),w.appendChild(c.element),w.appendChild(d.element),w.appendChild(u.element),w.appendChild(s.element),w.appendChild(h.element),w.appendChild(f.element),w.appendChild(v.element),w.appendChild(p.element),w.appendChild(m.element),w.appendChild(g.element),w.appendChild(C.element),w.appendChild(b.element),w.appendChild(k.element),w.appendChild(L.element),w.appendChild(B.element);var y={blackButton:r,element:w,select:t,whiteButton:u,setColor:E.setColor};return y}function i(e){var n=document.createElement("div");return n.className=e,n}function l(n){function t(){h.abortTouch(),f.abortTouch(),v.abortTouch()}function a(){n(o,l,r,c)}var o=0,l=0,r=0,c=1,s="EditColorPanel",h=d(function(e){o=e,a(),f.setHue(o),v.setHue(o),p.setHue(o)},a),f=m(function(e){l=e,a(),v.setSaturation(l),p.setSaturation(l)},a),v=u(function(e){r=e,a(),f.setLuminance(r),p.setLuminance(r)},a),p=e(function(e){c=e,a()},a),g=i(s);return g.appendChild(h.element),g.appendChild(f.element),g.appendChild(v.element),g.appendChild(p.element),{element:g,hide:function(){t(),p.abortTouch(),g.classList.remove("visible")},setColor:function(e,n,a,i){t(),o=e,l=n,r=a,c=i,h.setHue(o),f.setHue(o),f.setSaturation(l),f.setLuminance(r),v.setHue(o),v.setSaturation(l),v.setLuminance(r),p.setHue(o),p.setSaturation(l),p.setLuminance(r),p.setAlpha(c)},show:function(){g.classList.add("visible")}}}function r(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){var e=new Image;e.src=a.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},a.onabort=function(){},a.onerror=function(){},o.removeChild(e),t()}),o.appendChild(e)}var a=i("Button-content");a.style.backgroundImage="url(images/"+e+".svg)";var o=i("Button");return o.appendChild(a),t(),{element:o,addClass:function(e){o.classList.add(e)}}}function c(e,t,a){var o="FilePanel",l=n("file",e);l.addClass(o+"-newButton");var c=r("open",t);c.addClass(o+"-openButton");var d=n("save",a);d.addClass(o+"-saveButton");var u=i(o+"-content");u.appendChild(l.element),u.appendChild(c.element),u.appendChild(d.element);var s=i(o);s.appendChild(u);var h=u.classList;return{element:s,hide:function(){h.remove("visible")},show:function(){h.add("visible")}}}function d(e,n){var t=g(function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function u(e,n){function t(){var e="hsl("+a+", "+o+"%, 0%)",n="hsl("+a+", "+o+"%, 50%)",t="hsl("+a+", "+o+"%, 100%)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",c.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+t+", "+n+", "+e+")"}var a=0,o=0,l="LuminanceSlider",r=i(l+"-portraitBar"),c=i(l+"-landscapeBar"),d=g(function(n){e(100*n)},n);return d.addClass(l),d.barElement.appendChild(r),d.barElement.appendChild(c),t(),{abortTouch:d.abortTouch,element:d.element,setHue:function(e){a=e,t()},setLuminance:function(e){d.setRatio(e/100)},setSaturation:function(e){o=e,t()}}}function s(){function e(){o(),l(),a()}function a(){P.hide(),W.uncheck()}function o(){I.hide(),M.uncheck()}function l(){H.hide(),U.uncheck()}function r(){A.uncheck(),D.disable()}function d(){x.uncheck(),R.disable()}function u(){A.check(),D.enable()}function s(){x.check(),R.enable()}function m(){e(),d(),u(),H.setSize(w),A.mark(),x.unmark(),B(D),T=m}function g(){e(),r(),s(),H.setSize(E),x.mark(),A.unmark(),B(R),T=g}function k(e,n,t,a){D.setColor(e,n,t,a),A.setColor(e,n,t,a)}function L(e,n,t,a){R.setColor(e,n,t,a),x.setColor(e,n,t,a)}function B(e){var n=e.colorButton;I.select(n);var t=n.color,a=t.hue,o=t.saturation,i=t.luminance;e.setColor(a,o,i,t.alpha),H.setColor(a,o,i)}var E=4,w=8,y="MainPanel",S=t(),T=g,I=h(function(e,n,t,a,o){o==R.colorButton&&L(e,n,t,a),o==D.colorButton&&k(e,n,t,a),H.setColor(e,n,t)},function(){o(),a(),T()},function(e){if(T==g){var n=R.colorButton;n!=D.colorButton&&n.unmark(),R.colorButton=e,e.mark()}else{var n=D.colorButton;n!=R.colorButton&&n.unmark(),D.colorButton=e,e.mark()}}),R=v(E,S);R.colorButton=I.blackButton,R.enable();var D=v(w,S);D.colorButton=I.whiteButton;var H=f(function(e){T==g?(E=e,R.setSize(e)):(w=e,D.setSize(e))},function(){T()});H.setSize(E);var P=c(function(){S.operate(function(e){var n=e.canvas.width;e.fillStyle="#fff",e.globalAlpha=1,e.fillRect(0,0,n,n)}),T()},function(e){S.operate(function(n){var t=n.canvas.width,a=(t-e.width)/2,o=(t-e.height)/2;n.globalAlpha=1,n.drawImage(e,a,o)}),T()},function(){var e=S.element.offsetWidth,n=S.element.offsetHeight;p(S.canvas,e,n),T()}),x=C("pencil",g);x.addClass(y+"-pencilButton"),x.check();var A=C("eraser",m);A.addClass(y+"-eraserButton"),k(0,0,100,1),L(0,0,0,1);var M=n("palette",function(){M.isChecked()?T():(l(),a(),d(),r(),I.show(),M.check())});M.addClass(y+"-paletteButton");var U=n("params",function(){U.isChecked()?T():(o(),a(),d(),r(),H.show(),U.check())});U.addClass(y+"-paramsButton");var z=b(S.undo);S.onUndoAvailable(z.enable),S.onUndoUnavailable(z.disable);var W=n("burger",function(){W.isChecked()?T():(o(),l(),d(),r(),P.show(),W.check())});W.addClass(y+"-fileButton");var X=i(y+"-content");X.appendChild(S.element),X.appendChild(I.element),X.appendChild(H.element),X.appendChild(P.element);var Y=i(y+"-bar");Y.appendChild(x.element),Y.appendChild(A.element),Y.appendChild(M.element),Y.appendChild(U.element),Y.appendChild(z.element),Y.appendChild(W.element);var N=i(y);return N.appendChild(X),N.appendChild(Y),{element:N}}function h(e,n,t){function r(e){var n=e.hue,t=e.saturation,a=e.luminance,o=e.alpha;u.setColor(n,t,a,o),s.setColor(n,t,a,o)}var c="PalettePanel",d=o(function(a){m=a,t(a);var o=a.color;r(o),e(o.hue,o.saturation,o.luminance,o.alpha,a),u.isChecked()||n()}),u=a(function(){u.isChecked()?(s.hide(),u.uncheck(),p=!1):(s.show(),u.check(),p=!0)});u.setColor(0,0,0,1),u.addClass(c+"-previewButton");var s=l(function(n,t,a,o){u.setColor(n,t,a,o),d.setColor(n,t,a,o),e(n,t,a,o,m)}),h=i(c+"-secondLayer");h.appendChild(d.element),h.appendChild(u.element);var f=i(c+"-content");f.appendChild(s.element),f.appendChild(h);var v=i(c);v.appendChild(f);var p=!1,m=d.blackButton;return{blackButton:d.blackButton,element:v,whiteButton:d.whiteButton,hide:function(){s.hide(),f.classList.remove("visible")},select:function(e){m=e,d.select(e),r(e.color)},show:function(){p&&s.show(),f.classList.add("visible")}}}function f(e,n){function t(){c.clearRect(0,0,r.width,r.height),c.beginPath(),c.arc(r.width/2,r.height/2,(f+1)/2,0,2*Math.PI),c.fill()}var a="ParamsPanel",o=1,l=48,r=document.createElement("canvas");r.width=r.height=l+4,r.className=a+"-previewCanvas";var c=r.getContext("2d"),d=g(function(n){f=o+n*l,e(f),t()},n);d.addClass(a+"-slider");var u=i(a+"-content");u.appendChild(d.element),u.appendChild(r);var s=i(a);s.appendChild(u);var h=!1,f=o;return{element:s,hide:function(){d.abortTouch(),u.classList.remove("visible")},setColor:function(e,n,t){c.fillStyle="hsl("+e+", "+n+"%, "+t+"%)",h=!0},setSize:function(e){f=e,h=!0},show:function(){h&&(t(),h=!1,d.setRatio((f-o)/(l-o))),u.classList.add("visible")}}}function v(e,n){function t(t,a){!function(e,o,i){n.operate(function(n){n.lineWidth=e,n.fillStyle=i,n.beginPath(),n.arc(t,a,o,0,2*Math.PI),n.fill()})}(e,p,B)}function a(e){if(e.preventDefault(),f)f=!1;else{h=!0;var n=g.getBoundingClientRect();u=e.clientX-n.left,s=e.clientY-n.top,t(u,s)}}function o(){f?f=!1:h=!1}function i(e){if(f)f=!1;else if(h){var n=g.getBoundingClientRect(),t=e.clientX-n.left,a=e.clientY-n.top;l(u,s,t,a),u=t,s=a}}function l(t,a,o,i){!function(e,l){n.operate(function(n){n.lineWidth=e,n.strokeStyle=l,n.beginPath(),n.moveTo(t,a),n.lineTo(o,i),n.stroke()})}(e,B)}function r(e){f=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete v[n[t].identifier]}function c(e){f=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),t=e.changedTouches,a=0;a<t.length;a++){var o=t[a],i=v[o.identifier];if(i){var r=o.clientX-n.left,c=o.clientY-n.top;l(i.x,i.y,r,c),i.x=r,i.y=c}}}function d(e){f=!0,e.preventDefault();for(var n=g.getBoundingClientRect(),a=e.changedTouches,o=0;o<a.length;o++){var i=a[o],l=i.clientX-n.left,r=i.clientY-n.top;t(l,r),v[i.identifier]={x:l,y:r}}}var u,s,h=!1,f=!1,v={},p=e/2,m=!1,g=n.canvas,C=0,b=0,k=0,L=1,B="hsla(0, 0%, 0%, 1)";return{disable:function(){m&&(g.removeEventListener("mousedown",a),g.removeEventListener("mousemove",i),g.removeEventListener("mouseup",o),g.removeEventListener("touchstart",d),g.removeEventListener("touchmove",c),g.removeEventListener("touchend",r),m=!1)},enable:function(){m||(g.addEventListener("mousedown",a),g.addEventListener("mousemove",i),g.addEventListener("mouseup",o),g.addEventListener("touchstart",d),g.addEventListener("touchmove",c),g.addEventListener("touchend",r),m=!0)},setColor:function(e,n,t,a){C=e,b=n,k=t,L=a,B="hsla("+C+", "+b+"%, "+k+"%, "+L+")"},setSize:function(n){e=n,p=e/2}}}function p(e,n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var o=(n-e.width)/2,i=(t-e.height)/2,l=a.getContext("2d");l.drawImage(e,o,i);var r=document.createElement("a");r.href=a.toDataURL("image/png"),r.download="picture.png",r.style.position="absolute",r.style.top=r.style.left=0,document.body.appendChild(r),r.click(),document.body.removeChild(r)}function m(e,n){function t(){var e="hsl("+a+", 100%, "+o+"%)",n="hsl("+a+", 0%, "+o+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",c.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var a=0,o=0,l="SaturationSlider",r=i(l+"-portraitBar"),c=i(l+"-landscapeBar"),d=g(function(n){e(100*n)},n);return d.addClass(l),d.barElement.appendChild(r),d.barElement.appendChild(c),t(),{abortTouch:d.abortTouch,element:d.element,setHue:function(e){a=e,t()},setLuminance:function(e){o=e,t()},setSaturation:function(e){d.setRatio(e/100)}}}function g(e,n){function t(t){function i(n){var t=h.getBoundingClientRect(),o=u.offsetHeight;if(innerWidth>innerHeight){var i=h.offsetHeight;d=1-(n.clientY-t.top-o/2)/i}else{var l=h.offsetWidth;d=(n.clientX-t.left-o/2)/l}d=Math.max(0,Math.min(1,d)),a(),e(d)}function l(){endSlide(),n()}function f(e){r?r=!1:i(e)}function v(){r?r=!1:l()}function p(e){r=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===c){e.preventDefault(),l();break}}function m(e){r=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var a=n[t];if(a.identifier===c){e.preventDefault(),i(a);break}}}endSlide=function(){o=!1,c=null,s.remove("active"),removeEventListener("mousemove",f),removeEventListener("mouseup",v),removeEventListener("touchmove",m),removeEventListener("touchend",p)},o=!0,i(t),s.add("active"),addEventListener("mousemove",f),addEventListener("mouseup",v),addEventListener("touchmove",m),addEventListener("touchend",p)}function a(){u.style.top=100*(1-d)+"%",u.style.left=100*d+"%"}var o=!1,l="Slider",r=!1,c=null,d=0,u=i(l+"-handle"),s=u.classList,h=i(l+"-handleWrapper");h.appendChild(u);var f=i(l+"-bar"),v=i(l);return v.appendChild(f),v.appendChild(h),v.addEventListener("mousedown",function(e){e.preventDefault(),r?r=!1:t(e)}),v.addEventListener("touchstart",function(e){if(r=!0,null===c){e.preventDefault();var n=e.changedTouches[0];c=n.identifier,t(n)}}),a(),{barElement:f,element:v,abortTouch:function(){o&&endSlide()},addClass:function(e){v.classList.add(e)},setRatio:function(e){d=e,a()}}}function C(e,t){var a=n(e,t),o="ToolButton",l=i(o+"-color"),r=i(o+"-transparency");r.style.backgroundImage="url(images/color-background.svg)",r.appendChild(l);var c=a.element,d=c.classList;return a.contentElement.appendChild(r),{addClass:a.addClass,check:a.check,element:c,isChecked:a.isChecked,uncheck:a.uncheck,mark:function(){d.add("marked")},setColor:function(e,n,t,a){var o="hsla("+e+", "+n+"%, "+t+"%, "+a+")";l.style.background=o},unmark:function(){d.remove("marked")}}}function b(e){function n(){function n(){removeEventListener("mouseup",t),removeEventListener("touchend",a),c.remove("active"),clearInterval(o)}function t(){i?i=!1:n()}function a(e){i=!0;for(var t=e.changedTouches,a=0;a<t.length;a++)t[a].identifier===r&&(r=null,n())}var i=!1;addEventListener("touchend",a),addEventListener("mouseup",t),c.add("active"),o=setInterval(e,50),e()}var t=i("Button-content");t.style.backgroundImage="url(images/undo.svg)";var a=i("Button UndoButton disabled");a.appendChild(t),a.addEventListener("mousedown",function(e){e.preventDefault(),l?l=!1:n()}),a.addEventListener("touchstart",function(e){l=!0,null===r&&(e.preventDefault(),r=e.changedTouches[0].identifier,n())});var o,l=!1,r=null,c=a.classList;return{element:a,disable:function(){c.add("disabled")},enable:function(){c.remove("disabled")}}}!function(){var e=i("Main-progress"),n=i("Main-loadBar");n.appendChild(e),document.body.appendChild(n);var t=0,a=["pencil","eraser","palette","params","undo","burger"];a.forEach(function(o){var i=new Image;i.src="images/"+o+".svg",i.onload=i.onerror=i.onabort=function(){if(t++,e.style.width=t/a.length*100+"%",t==a.length){var o=s();document.body.removeChild(n),document.body.appendChild(o.element)}}})}()}();