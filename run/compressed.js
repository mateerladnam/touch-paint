!function(){function e(e,n){function t(){var e=l+", "+c+"%, "+u+"%",n="hsl("+e+")",t="hsla("+e+", 0)",o="url(images/color-background.svg)",r="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";a.style.backgroundImage="linear-gradient("+r+"), linear-gradient(90deg, "+t+", "+n+"), "+o,i.style.backgroundImage="linear-gradient(90deg, "+r+"), linear-gradient("+n+", "+t+"), "+o}var o="AlphaSlider",a=r(o+"-portraitBar"),i=r(o+"-landscapeBar"),l=0,c=0,u=0,d=D(function(n){e(n),t()},n);return d.setRatio(1),d.addClass(o),d.barElement.appendChild(a),d.barElement.appendChild(i),t(),{abortTouch:d.abortTouch,element:d.element,setAlpha:d.setRatio,setHue:function(e){l=e,t()},setLuminance:function(e){u=e,t()},setSaturation:function(e){c=e,t()}}}function n(e,n){function t(){d.addEventListener("mousedown",a),d.addEventListener("touchstart",l)}function o(){n(),v.add("active"),clearTimeout(s),s=setTimeout(function(){v.remove("active")},100)}function a(e){0===e.button&&(e.preventDefault(),c?c=!1:o())}function i(e){u.style.backgroundImage="url(images/"+e+".svg)"}function l(e){c=!0,e.preventDefault(),o()}var c=!1,u=r("Button-content"),d=r("Button");d.appendChild(u);var s,h=!1,v=d.classList;return i(e),t(),{contentElement:u,element:d,setIcon:i,addClass:function(e){v.add(e)},check:function(){v.add("checked"),h=!0},disable:function(){v.add("disabled"),d.removeEventListener("mousedown",a),d.removeEventListener("touchstart",l)},enable:function(){v.remove("disabled"),t()},isChecked:function(){return h},uncheck:function(){v.remove("checked"),h=!1}}}function t(e){function n(n){var s=d.getBoundingClientRect(),h=Math.floor(n.clientX-s.left),v=Math.floor(n.clientY-s.top),f=d.getContext("2d"),m=f.getImageData(h,v,1,1),p=m.data,g=p[0],C=p[1],b=p[2];!function(n,r,l,c){var u=1-c,s=n*c,f=r*c,m=l*c;e.operate(function(e){function c(e,n){if(!(i>e||e==o||t>n||n==a)){if(y[n]){if(y[n][e])return}else y[n]=Object.create(null);y[n][e]=!0,B.push([e,n])}}var p=d.width,k=d.height,L=e.getImageData(0,0,p,k),E=L.data,B=[],y=Object.create(null);c(h,v);for(var w=Object.create(null),T=20;B.length;){var S=B.shift(),D=S[0],x=S[1],M=4*(x*p+D),P=M+1,I=P+1,z=E[M],R=E[P],H=E[I],A=Math.abs(g-z),N=Math.abs(C-R),W=Math.abs(b-H),X=Math.max(A,N,W);X>T?(w[x]||(w[x]=Object.create(null)),w[x][D]=!0):(E[M]=s+z*u,E[P]=f+R*u,E[I]=m+H*u,c(D+1,x),c(D-1,x),c(D,x+1),c(D,x-1))}for(var Y in w){var U=w[Y];for(var O in U){var M=4*(Y*p+Number(O)),P=M+1,I=P+1,z=E[M],R=E[P],H=E[I];E[M]=((z+n)/2+s+z*u)/2,E[P]=((R+r)/2+f+R*u)/2,E[I]=((H+l)/2+m+z*u)/2}}e.putImageData(L,0,0)},200)}(r,l,c,u)}var t,o,a,i,r=0,l=0,c=0,u=1,d=e.canvas,h=!1;return{disable:function(){h&&(d.removeEventListener("mousedown",n),h=!1)},enable:function(){h||(d.addEventListener("mousedown",n),h=!0)},setColor:function(e,n,t,o){var a=s(e,n,t);r=a.r,l=a.g,c=a.b,u=o},resize:function(e,n){var r=d.width/2,l=d.height/2,c=e/2,u=n/2;t=Math.floor(l-u),o=Math.floor(r+c),a=Math.ceil(l+u),i=Math.ceil(r-c)}}}function o(){var e="Canvas",n=Math.max(screen.width,screen.height),t=document.createElement("canvas");t.className=e+"-canvas",t.width=t.height=n,t.style.left=t.style.top=-n/2+"px";var o=t.getContext("2d");o.lineCap="round",o.fillStyle="#fff",o.fillRect(0,0,n,n);var a=r(e+"-center");a.appendChild(t);var i=r(e);i.appendChild(a);var l,c,u=[],d=128,s=[];return{canvas:t,element:i,onUndoAvailable:function(e){l=e},onUndoUnavailable:function(e){c=e},operate:function(e,t){u.push({operation:e,timeout:t}),1==u.length&&l(),e(o);var a=u.length-d;if(!(0>a)){var i=Math.floor(a/d);if(!s[i]){var r=document.createElement("canvas");r.width=r.height=n;var c=r.getContext("2d");c.lineCap="round",i?c.drawImage(s[i-1],0,0):(c.fillStyle="#fff",c.fillRect(0,0,n,n)),s.push(r);for(var h=a;a+d>h;h++)u[h].operation(c)}}},undo:function(){if(o.globalAlpha=1,s.length?o.drawImage(s[s.length-1],0,0):(o.fillStyle="#fff",o.fillRect(0,0,n,n)),!u.length)return 50;for(var e=u.pop(),t=s.length*d,a=t;a<u.length;a++)u[a].operation(o);return s.length*d>u.length&&s.pop(),u.length||c(),e.timeout}}}function a(e){function n(){e(),s.add("active"),clearTimeout(u),u=setTimeout(function(){s.remove("active")},100)}var t=!1,o="ColorButton",a=r(o+"-opaque"),i=r(o+"-color");i.appendChild(a);var l=r(o+"-transparency Button-content");l.appendChild(i),l.style.backgroundImage="url(images/color-background.svg)";var c=r("Button");c.appendChild(l),c.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),t?t=!1:n())}),c.addEventListener("touchstart",function(e){t=!0,e.preventDefault(),n()});var u,d=!1,s=c.classList,h={};return{color:h,element:c,addClass:function(e){s.add(e)},check:function(){s.add("checked"),d=!0},isChecked:function(){return d},mark:function(){s.add("marked")},setColor:function(e,n,t,o){h.hue=e,h.saturation=n,h.luminance=t,h.alpha=o;var r=e+", "+n+"%, "+t+"%",l="hsla("+r+", "+o+")";i.style.backgroundColor=l;var c="hsl("+r+")";a.style.backgroundColor=c},uncheck:function(){s.remove("checked"),d=!1},unmark:function(){s.remove("marked")}}}function i(e){function n(n,r,l,c){var u=a(function(){t(u),e(u)});return u.setColor(n,r,l,1),u.addClass(i+"-colorButton"),u.addClass(i+"-"+c+"Button"),o.push(u),u}function t(e){B.uncheck(),e.check(),B=e,w.setColor=e.setColor}var o=[],i="ColorButtonsPanel",l=n(0,0,0,"black");l.check(),l.mark();var c=n(0,0,40,"darkGrey"),u=n(0,0,70,"lightGrey"),d=n(0,0,100,"white");d.mark();var s=n(232,100,50,"blue"),h=n(210,100,80,"skyBlue"),v=n(114,100,33,"darkGreen"),f=n(115,87,50,"green"),m=n(4,100,47,"red"),p=n(60,100,50,"yellow"),g=n(30,100,33,"brown"),C=n(32,100,50,"orange"),b=n(306,100,33,"violet"),k=n(312,100,83,"pink"),L=n(30,55,65,"darkSkin"),E=n(31,55,75,"lightSkin"),B=l,y=r(i);y.appendChild(l.element),y.appendChild(c.element),y.appendChild(u.element),y.appendChild(d.element),y.appendChild(s.element),y.appendChild(h.element),y.appendChild(v.element),y.appendChild(f.element),y.appendChild(m.element),y.appendChild(p.element),y.appendChild(g.element),y.appendChild(C.element),y.appendChild(b.element),y.appendChild(k.element),y.appendChild(L.element),y.appendChild(E.element);var w={blackButton:l,element:y,select:t,whiteButton:d,setColor:B.setColor};return w}function r(e){var n=document.createElement("div");return n.className=e,n}function l(n){function t(){d.abortTouch(),s.abortTouch(),v.abortTouch()}function o(){n(a,i,l,c)}var a=0,i=0,l=0,c=1,u="EditColorPanel",d=h(function(e){a=e,o(),s.setHue(a),v.setHue(a),m.setHue(a)},o),s=S(function(e){i=e,o(),v.setSaturation(i),m.setSaturation(i)},o),v=f(function(e){l=e,o(),s.setLuminance(l),m.setLuminance(l)},o),m=e(function(e){c=e,o()},o),p=r(u);return p.appendChild(d.element),p.appendChild(s.element),p.appendChild(v.element),p.appendChild(m.element),{element:p,hide:function(){t(),m.abortTouch(),p.classList.remove("visible")},setColor:function(e,n,o,r){t(),a=e,i=n,l=o,c=r,d.setHue(a),s.setHue(a),s.setSaturation(i),s.setLuminance(l),v.setHue(a),v.setSaturation(i),v.setLuminance(l),m.setHue(a),m.setSaturation(i),m.setLuminance(l),m.setAlpha(c)},show:function(){p.classList.add("visible")}}}function c(e,n){function t(t){var a={};i(a,t);var r={x:a.x,y:a.y},l={color:b,endPoint:r,size:e,startPoint:a,end:function(){d.splice(d.indexOf(l),1),u(),n.operate(function(e){o(e,l)},200)},move:function(e){i(r,e),u()}};return d.push(l),u(),l}function o(e,n){var t=n.startPoint,o=t.x,a=t.y,i=n.endPoint,r=i.x,l=i.y,c=(r-o)/2,u=(l-a)/2,d=.5522848,s=c*d,h=u*d,v=o+c,f=a+u;e.beginPath(),e.moveTo(o,f),e.bezierCurveTo(o,f-h,v-s,a,v,a),e.bezierCurveTo(v+s,a,r,f-h,r,f),e.bezierCurveTo(r,f+h,v+s,l,v,l),e.bezierCurveTo(v-s,l,o,f+h,o,f),e.lineJoin="round",e.lineWidth=n.size,e.strokeStyle=n.color,e.stroke()}function a(e){function n(e){a.move(e),u()}function o(){a.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",o)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var a=t(e);addEventListener("mousemove",n),addEventListener("mouseup",o)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t],a=o.identifier,i=h[a];i&&(i.end(),delete h[a])}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t],a=h[o.identifier];a&&a.move(o)}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,o=0;o<n.length;o++){var a=n[o];h[a.identifier]=t(a)}}function u(){L.clearRect(0,0,k.width,k.height),d.forEach(function(e){o(L,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,m=0,p=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",k=document.createElement("canvas");k.className="EllipseTool-overlayCanvas",k.width=f.width,k.height=f.height,k.style.top=f.style.top,k.style.left=f.style.left;var L=k.getContext("2d");return f.parentNode.appendChild(k),{disable:function(){v&&(f.removeEventListener("mousedown",a),f.removeEventListener("touchstart",c),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",a),f.addEventListener("touchstart",c),f.addEventListener("touchmove",l),f.addEventListener("touchend",r),v=!0)},setColor:function(e,n,t,o){m=e,p=n,g=t,C=o,b="hsla("+m+", "+p+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function u(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var o=new FileReader;o.readAsDataURL(e.files[0]),o.onload=function(){var e=new Image;e.src=o.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},o.onabort=function(){},o.onerror=function(){},a.removeChild(e),t()}),a.appendChild(e)}var o=r("Button-content");o.style.backgroundImage="url(images/"+e+".svg)";var a=r("Button");return a.appendChild(o),t(),{element:a,addClass:function(e){a.classList.add(e)}}}function d(e,t,o){var a="FilePanel",i=n("file",e);i.addClass(a+"-newButton");var l=u("open",t);l.addClass(a+"-openButton");var c=n("save",o);c.addClass(a+"-saveButton");var d=r(a+"-content");d.appendChild(i.element),d.appendChild(l.element),d.appendChild(c.element);var s=r(a);s.appendChild(d);var h=d.classList;return{element:s,hide:function(){h.remove("visible")},show:function(){h.add("visible")}}}function s(e,n,t){var o,a,i,r,l,c;return isFinite(e)||(e=0),isFinite(n)||(n=0),isFinite(t)||(t=0),e/=60,0>e&&(e=6- -e%6),e%=6,n=Math.max(0,Math.min(1,n/100)),t=Math.max(0,Math.min(1,t/100)),l=(1-Math.abs(2*t-1))*n,c=l*(1-Math.abs(e%2-1)),1>e?(o=l,a=c,i=0):2>e?(o=c,a=l,i=0):3>e?(o=0,a=l,i=c):4>e?(o=0,a=c,i=l):5>e?(o=c,a=0,i=l):(o=l,a=0,i=c),r=t-l/2,o=Math.round(255*(o+r)),a=Math.round(255*(a+r)),i=Math.round(255*(i+r)),{r:o,g:a,b:i}}function h(e,n){var t=D(function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function v(e,n){function t(t){var a={};i(a,t);var r={x:a.x,y:a.y},l={color:b,endPoint:r,size:e,startPoint:a,end:function(){d.splice(d.indexOf(l),1),u(),n.operate(function(e){o(e,l)},200)},move:function(e){i(r,e),u()}};return d.push(l),u(),l}function o(e,n){var t=n.startPoint,o=n.endPoint;e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(o.x,o.y),e.strokeStyle=n.color,e.lineCap="round",e.lineWidth=n.size,e.stroke()}function a(e){function n(e){a.move(e),u()}function o(){a.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",o)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var a=t(e);addEventListener("mousemove",n),addEventListener("mouseup",o)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t],a=o.identifier,i=h[a];i&&(i.end(),delete h[a])}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t],a=h[o.identifier];a&&a.move(o)}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,o=0;o<n.length;o++){var a=n[o];h[a.identifier]=t(a)}}function u(){L.clearRect(0,0,k.width,k.height),d.forEach(function(e){o(L,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,m=0,p=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",k=document.createElement("canvas");k.className="LineTool-overlayCanvas",k.width=f.width,k.height=f.height,k.style.top=f.style.top,k.style.left=f.style.left;var L=k.getContext("2d");return f.parentNode.appendChild(k),{disable:function(){v&&(f.removeEventListener("mousedown",a),f.removeEventListener("touchstart",c),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",a),f.addEventListener("touchstart",c),f.addEventListener("touchmove",l),f.addEventListener("touchend",r),v=!0)},setColor:function(e,n,t,o){m=e,p=n,g=t,C=o,b="hsla("+m+", "+p+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function f(e,n){function t(){var e="hsl("+o+", "+a+"%, 0%)",n="hsl("+o+", "+a+"%, 50%)",t="hsl("+o+", "+a+"%, 100%)",i="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";l.style.backgroundImage="linear-gradient("+i+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",c.style.backgroundImage="linear-gradient(90deg, "+i+"), linear-gradient("+t+", "+n+", "+e+")"}var o=0,a=0,i="LuminanceSlider",l=r(i+"-portraitBar"),c=r(i+"-landscapeBar"),u=D(function(n){e(100*n)},n);return u.addClass(i),u.barElement.appendChild(l),u.barElement.appendChild(c),t(),{abortTouch:u.abortTouch,element:u.element,setHue:function(e){o=e,t()},setLuminance:function(e){u.setRatio(e/100)},setSaturation:function(e){a=e,t()}}}function m(e){var n="MainBar",t=r(n+"-alternativeBar");t.appendChild(e.element);var o=r(n+"-bar"),a=r(n+"-scroll");a.appendChild(o),a.appendChild(t);var i=r(n);i.appendChild(a);var l=a.classList;return{element:i,addButton:function(e){o.appendChild(e.element)},show:function(){i.classList.add("visible")},slide:function(){l.add("slide")},unslide:function(){l.remove("slide")}}}function p(){function e(){i(),l(),a(),rn()}function a(){K.hide(),nn.uncheck()}function i(){X.hide(),$.uncheck()}function l(){J.hide(),_.uncheck()}function u(){Z.uncheck(),V.disable()}function s(){Q.uncheck(),G.disable()}function h(){Z.check(),V.enable()}function f(){Q.check(),G.enable()}function p(){W.hide(),e(),s(),h(),J.setSize(R),Z.mark(),Q.unmark(),I(Z,[V]),N=p}function L(){e(),u(),f(),J.setSize(z),Q.mark(),Z.unmark(),I(Q,[Y,U,O,F,j]),N=L}function w(e,n,t,o,a){a==Q.colorButton&&D(e,n,t,o),a==Z.colorButton&&S(e,n,t,o),J.setColor(e,n,t)}function S(e,n,t,o){V.setColor(e,n,t,o),Z.setColor(e,n,t,o)}function D(e,n,t,o){G.setColor(e,n,t,o),Q.setColor(e,n,t,o)}function I(e,n){var t=e.colorButton;X.select(t);var o=t.color,a=o.hue,i=o.saturation,r=o.luminance;n.forEach(function(e){e.setColor(a,i,r,o.alpha)}),J.setColor(a,i,r)}var z=4,R=8,H="MainPanel",A=o(),N=L,W=M(function(){Q.setIcon("pencil"),G.disable(),G=Y,G.enable(),_.enable()},function(){Q.setIcon("line"),G.disable(),G=U,G.enable(),_.enable()},function(){Q.setIcon("ellipse"),G.disable(),G=O,G.enable(),_.enable()},function(){Q.setIcon("rectangle"),G.disable(),G=F,G.enable(),_.enable()},function(){Q.setIcon("bucket"),G.disable(),G=j,G.enable(),_.disable()}),X=C(w,function(){i(),a(),N()},function(e){if(N==L){var n=Q.colorButton;n!=Z.colorButton&&n.unmark(),Q.colorButton=e,e.mark()}else{var n=Z.colorButton;n!=Q.colorButton&&n.unmark(),Z.colorButton=e,e.mark()}},function(e){var n=e.color;on.setColor(n.hue,n.saturation,n.luminance,1),q.enable(),X.hide(),an.slide()}),Y=k(z,A),U=v(z,A),O=c(z,A),F=y(z,A),j=t(A),V=k(R,A),G=Y,q=B(A,function(e,n,t){on.setColor(e,n,t,1)}),J=b(function(e){N==L?(z=e,Y.setSize(e),U.setSize(e),O.setSize(e),F.setSize(e)):(R=e,V.setSize(e))},function(){N()});J.setSize(z);var K=d(function(){A.operate(function(e){var n=e.canvas.width;e.fillStyle="#fff",e.globalAlpha=1,e.fillRect(0,0,n,n)},200),N()},function(e){A.operate(function(n){var t=A.element;g(n,e,t.offsetWidth,t.offsetHeight)},200),N()},function(){var e=A.element,n=e.offsetWidth,t=e.offsetHeight;T(A.canvas,n,t),N()}),Q=x("pencil",function(){Q.isChecked()&&(W.isVisible()?W.hide():W.show()),L()});Q.addClass(H+"-primaryToolButton"),Q.colorButton=X.blackButton;var Z=x("eraser",p);Z.addClass(H+"-eraserButton"),Z.colorButton=X.whiteButton,S(0,0,100,1),D(0,0,0,1);var $=n("palette",function(){$.isChecked()?N():(s(),u(),W.hide(),l(),a(),rn(),X.show(),$.check())});$.addClass(H+"-paletteButton");var _=n("params",function(){_.isChecked()?N():(s(),u(),W.hide(),i(),a(),rn(),J.show(),_.check())});_.addClass(H+"-paramsButton");var en=P(A.undo);A.onUndoAvailable(en.enable),A.onUndoUnavailable(en.disable);var nn=n("burger",function(){nn.isChecked()?N():(s(),u(),W.hide(),i(),l(),rn(),K.show(),nn.check())});nn.addClass(H+"-fileButton");var tn=r(H+"-content");tn.appendChild(A.element),tn.appendChild(W.element),tn.appendChild(X.element),tn.appendChild(J.element),tn.appendChild(K.element);var on=E(function(e,n,t){X.pickColor(e,n,t),w(e,n,t,1,X.getActiveButton())},function(){q.disable(),rn(),X.isEditVisible()?X.show():N()}),an=m(on);an.addButton(Q),an.addButton(Z),an.addButton($),an.addButton(_),an.addButton(en),an.addButton(nn);var rn=an.unslide,ln=r(H);return ln.appendChild(tn),ln.appendChild(an.element),{element:ln,resize:function(){var e=A.element;j.resize(e.offsetWidth,e.offsetHeight)},show:function(){L(),an.show()}}}function g(e,n,t,o){var a,i,r=e.canvas,l=t/o,c=n.width/n.height;l>c?(a=t,i=a/c):(i=o,a=i*c);var u=(r.width-a)/2,d=(r.height-i)/2;e.globalAlpha=1,e.drawImage(n,u,d,a,i)}function C(e,n,t,o){function c(e){var n=e.hue,t=e.saturation,o=e.luminance,a=e.alpha;s.setColor(n,t,o,a),h.setColor(n,t,o,a)}var u="PalettePanel",d=i(function(o){b=o,t(o);var a=o.color;c(a),e(a.hue,a.saturation,a.luminance,a.alpha,o),s.isChecked()||n()}),s=a(function(){g&&(s.isChecked()?(h.hide(),s.uncheck(),C=!1):(h.show(),s.check(),C=!0))});s.setColor(0,0,0,1),s.addClass(u+"-previewButton");var h=l(function(n,t,o,a){s.setColor(n,t,o,a),d.setColor(n,t,o,a),e(n,t,o,a,b)}),v=L(function(){o(b)}),f=r(u+"-secondLayer");f.appendChild(d.element),f.appendChild(s.element),f.appendChild(v.element);var m=r(u+"-content");m.appendChild(h.element),m.appendChild(f);var p=r(u);p.appendChild(m);var g=!1,C=!1,b=d.blackButton;return{blackButton:d.blackButton,element:p,whiteButton:d.whiteButton,getActiveButton:function(){return b},hide:function(){g&&(h.hide(),m.classList.remove("visible"),g=!1)},isEditVisible:function(){return C},select:function(e){b=e,d.select(e),c(e.color)},pickColor:function(e,n,t){var o=s.color.alpha;h.setColor(e,n,t,o),s.setColor(e,n,t,o),d.setColor(e,n,t,o)},show:function(){g||(C&&h.show(),m.classList.add("visible"),g=!0)}}}function b(e,n){function t(){c.clearRect(0,0,l.width,l.height),c.beginPath(),c.arc(l.width/2,l.height/2,(v+1)/2,0,2*Math.PI),c.fill()}var o="ParamsPanel",a=1,i=48,l=document.createElement("canvas");l.width=l.height=i+4,l.className=o+"-previewCanvas";var c=l.getContext("2d"),u=D(function(n){v=a+n*i,e(v),t()},n);u.addClass(o+"-slider");var d=r(o+"-content");d.appendChild(u.element),d.appendChild(l);var s=r(o);s.appendChild(d);var h=!1,v=a;return{element:s,hide:function(){u.abortTouch(),d.classList.remove("visible")},setColor:function(e,n,t){c.fillStyle="hsl("+e+", "+n+"%, "+t+"%)",h=!0},setSize:function(e){v=e,h=!0},show:function(){h&&(t(),h=!1,u.setRatio((v-a)/(i-a))),d.classList.add("visible")}}}function k(e,n){function t(t,o){!function(e,a,i){n.operate(function(n){n.lineWidth=e,n.fillStyle=i,n.beginPath(),n.arc(t,o,a,0,2*Math.PI),n.fill()},50)}(e,d,g)}function o(e){function n(){c?c=!1:(removeEventListener("mousemove",o),removeEventListener("mouseup",n))}function o(e){if(c)c=!1;else{var n=h.getBoundingClientRect(),t=e.clientX-n.left,o=e.clientY-n.top;a(r,l,t,o),r=t,l=o}}if(0===e.button)if(e.preventDefault(),c)c=!1;else{var i=h.getBoundingClientRect(),r=e.clientX-i.left,l=e.clientY-i.top;t(r,l),addEventListener("mousemove",o),addEventListener("mouseup",n)}}function a(t,o,a,i){!function(e,r){n.operate(function(n){n.lineWidth=e,n.strokeStyle=r,n.beginPath(),n.moveTo(t,o),n.lineTo(a,i),n.stroke()},50)}(e,g)}function i(e){c=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete u[n[t].identifier]}function r(e){c=!0,e.preventDefault();for(var n=h.getBoundingClientRect(),t=e.changedTouches,o=0;o<t.length;o++){var i=t[o],r=u[i.identifier];if(r){var l=i.clientX-n.left,d=i.clientY-n.top;a(r.x,r.y,l,d),r.x=l,r.y=d}}}function l(e){c=!0,e.preventDefault();for(var n=h.getBoundingClientRect(),o=e.changedTouches,a=0;a<o.length;a++){var i=o[a],r=i.clientX-n.left,l=i.clientY-n.top;t(r,l),u[i.identifier]={x:r,y:l}}}var c=!1,u={},d=e/2,s=!1,h=n.canvas,v=0,f=0,m=0,p=1,g="hsla(0, 0%, 0%, 1)";return{disable:function(){s&&(h.removeEventListener("mousedown",o),h.removeEventListener("touchstart",l),h.removeEventListener("touchmove",r),h.removeEventListener("touchend",i),s=!1)},enable:function(){s||(h.addEventListener("mousedown",o),h.addEventListener("touchstart",l),h.addEventListener("touchmove",r),h.addEventListener("touchend",i),s=!0)},setColor:function(e,n,t,o){v=e,f=n,m=t,p=o,g="hsla("+v+", "+f+"%, "+m+"%, "+p+")"},setSize:function(n){e=n,d=e/2}}}function L(e){var t=n("pick",e);return t.addClass("PickButton"),t}function E(e,t){var o="PickPanel",i=a(function(){var n=i.color;e(n.hue,n.saturation,n.luminance),t()});i.addClass(o+"-colorButton");var l=n("cancel",t);l.addClass(o+"-cancelButton");var c=r(o);return c.appendChild(i.element),c.appendChild(l.element),{element:c,setColor:i.setColor}}function B(e,n){function t(e){var n=o(e);r(n[0],n[1])}function o(e){var n=f.getBoundingClientRect(),t=Math.floor(e.clientX-n.left),o=Math.floor(e.clientY-n.top);return[t,o]}function a(e){function n(e){e.preventDefault(),s?s=!1:i(e)}function o(e){e.preventDefault(),removeEventListener("mousemove",n),removeEventListener("mouseup",o)}0===e.button&&(e.preventDefault(),s?s=!1:(t(e),addEventListener("mousemove",n),addEventListener("mouseup",o)))}function i(e){var n=o(e),t=n[0],a=n[1];t>=0&&m>t&&a>=0&&p>a&&r(t,a)}function r(e,t){var o=4*(e+t*m),a=w(d[o],d[o+1],d[o+2]);n(a.hue,a.saturation,a.luminance)}function l(e){e.preventDefault(),s=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===h){h=null;break}}function c(e){e.preventDefault(),s=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t];if(o.identifier===h){i(o);break}}}function u(e){if(e.preventDefault(),s=!0,null===h){var n=e.changedTouches[0];h=n.identifier,t(n)}}var d,s=!1,h=null,v=!1,f=e.canvas,m=f.width,p=f.height,g=f.getContext("2d");return{disable:function(){v&&(f.removeEventListener("mousedown",a),f.removeEventListener("touchstart",u),removeEventListener("touchmove",c),removeEventListener("touchend",l),v=!1)},enable:function(){v||(f.addEventListener("mousedown",a),f.addEventListener("touchstart",u),addEventListener("touchmove",c),addEventListener("touchend",l),v=!0,d=g.getImageData(0,0,m,p).data)}}}function y(e,n){function t(t){var a={};i(a,t);var r={x:a.x,y:a.y},l={color:b,endPoint:r,size:e,startPoint:a,end:function(){d.splice(d.indexOf(l),1),u(),n.operate(function(e){o(e,l)},200)},move:function(e){i(r,e),u()}};return d.push(l),u(),l}function o(e,n){var t=n.startPoint,o=t.x,a=t.y,i=n.endPoint;e.beginPath(),e.rect(o,a,i.x-o,i.y-a),e.strokeStyle=n.color,e.lineJoin="round",e.lineWidth=n.size,e.stroke()}function a(e){function n(e){a.move(e),u()}function o(){a.end(),removeEventListener("mousemove",n),removeEventListener("mouseup",o)}if(0===e.button)if(e.preventDefault(),s)s=!1;else{var a=t(e);addEventListener("mousemove",n),addEventListener("mouseup",o)}}function i(e,n){var t=f.getBoundingClientRect();e.x=n.clientX-t.left,e.y=n.clientY-t.top}function r(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t],a=o.identifier,i=h[a];i&&(i.end(),delete h[a])}}function l(e){s=!0,e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t],a=h[o.identifier];a&&a.move(o)}}function c(e){s=!0,e.preventDefault();for(var n=e.changedTouches,o=0;o<n.length;o++){var a=n[o];h[a.identifier]=t(a)}}function u(){L.clearRect(0,0,k.width,k.height),d.forEach(function(e){o(L,e)})}var d=[],s=!1,h={},v=!1,f=n.canvas,m=0,p=0,g=0,C=1,b="hsla(0, 0%, 0%, 1)",k=document.createElement("canvas");k.className="RectangleTool-overlayCanvas",k.width=f.width,k.height=f.height,k.style.top=f.style.top,k.style.left=f.style.left;var L=k.getContext("2d");return f.parentNode.appendChild(k),{disable:function(){v&&(f.removeEventListener("mousedown",a),f.removeEventListener("touchstart",c),f.removeEventListener("touchmove",l),f.removeEventListener("touchend",r),v=!1)},enable:function(){v||(f.addEventListener("mousedown",a),f.addEventListener("touchstart",c),f.addEventListener("touchmove",l),f.addEventListener("touchend",r),v=!0)},setColor:function(e,n,t,o){m=e,p=n,g=t,C=o,b="hsla("+m+", "+p+"%, "+g+"%, "+C+")"},setSize:function(n){e=n}}}function w(e,n,t){var o,a,i,r,l,c;if(e/=255,n/=255,t/=255,o=Math.max(e,n,t),a=Math.min(e,n,t),l=(o+a)/2,o==a)i=r=0;else{switch(c=o-a,r=l>.5?c/(2-o-a):c/(o+a),o){case e:i=(n-t)/c+(t>n?6:0);break;case n:i=(t-e)/c+2;break;case t:i=(e-n)/c+4}i/=6}return i=Math.floor(360*i),r=Math.floor(100*r),l=Math.floor(100*l),{hue:i,saturation:r,luminance:l}}function T(e,n,t){var o=document.createElement("canvas");o.width=n,o.height=t;var a=(n-e.width)/2,i=(t-e.height)/2,r=o.getContext("2d");r.drawImage(e,a,i);var l=document.createElement("a");l.href=o.toDataURL("image/png"),l.download="picture.png",l.style.position="absolute",l.style.top=l.style.left=0,document.body.appendChild(l),l.click(),document.body.removeChild(l)}function S(e,n){function t(){var e="hsl("+o+", 100%, "+a+"%)",n="hsl("+o+", 0%, "+a+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";l.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",c.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var o=0,a=0,i="SaturationSlider",l=r(i+"-portraitBar"),c=r(i+"-landscapeBar"),u=D(function(n){e(100*n)},n);return u.addClass(i),u.barElement.appendChild(l),u.barElement.appendChild(c),t(),{abortTouch:u.abortTouch,element:u.element,setHue:function(e){o=e,t()},setLuminance:function(e){a=e,t()},setSaturation:function(e){u.setRatio(e/100)}}}function D(e,n){function t(t){function i(n){var t=h.getBoundingClientRect(),a=d.offsetHeight;if(innerWidth>innerHeight){var i=h.offsetHeight;u=1-(n.clientY-t.top-a/2)/i}else{var r=h.offsetWidth;u=(n.clientX-t.left-a/2)/r}u=Math.max(0,Math.min(1,u)),o(),e(u)}function r(){v(),n()}function v(){a=!1,c=null,s.remove("active"),removeEventListener("mousemove",f),removeEventListener("mouseup",m),removeEventListener("touchmove",g),removeEventListener("touchend",p)}function f(e){l?l=!1:i(e)}function m(){l?l=!1:r()}function p(e){l=!0;for(var n=e.changedTouches,t=0;t<n.length;t++)if(n[t].identifier===c){e.preventDefault(),r();break}}function g(e){l=!0;for(var n=e.changedTouches,t=0;t<n.length;t++){var o=n[t];if(o.identifier===c){e.preventDefault(),i(o);break}}}a=!0,i(t),s.add("active"),addEventListener("mousemove",f),addEventListener("mouseup",m),addEventListener("touchmove",g),addEventListener("touchend",p)}function o(){d.style.top=100*(1-u)+"%",d.style.left=100*u+"%"}var a=!1,i="Slider",l=!1,c=null,u=0,d=r(i+"-handle"),s=d.classList,h=r(i+"-handleWrapper");h.appendChild(d);var v=r(i+"-bar"),f=r(i);return f.appendChild(v),f.appendChild(h),f.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),l?l=!1:t(e))}),f.addEventListener("touchstart",function(e){if(l=!0,null===c){e.preventDefault();var n=e.changedTouches[0];c=n.identifier,t(n)}}),o(),{barElement:v,element:f,abortTouch:function(){a&&endSlide()},addClass:function(e){f.classList.add(e)},setRatio:function(e){u=e,o()}}}function x(e,t){var o=n(e,t),a="ToolButton",i=r(a+"-opaque"),l=r(a+"-color");l.appendChild(i);var c=r(a+"-transparency");c.style.backgroundImage="url(images/color-background.svg)",c.appendChild(l);var u=o.element,d=u.classList;return o.contentElement.appendChild(c),{addClass:o.addClass,check:o.check,element:u,isChecked:o.isChecked,setIcon:o.setIcon,uncheck:o.uncheck,mark:function(){d.add("marked")},setColor:function(e,n,t,o){var a=e+", "+n+"%, "+t+"%",r="hsla("+a+", "+o+")";l.style.background=r;var c="hsl("+a+")";i.style.background=c},unmark:function(){d.remove("marked")}}}function M(e,t,o,a,i){function l(){p.remove("visible"),g=!1}var c="ToolPanel",u=n("pencil",function(){d.uncheck(),s.uncheck(),h.uncheck(),v.uncheck(),u.check(),e(),l()});u.addClass(c+"-pencilButton"),u.check();var d=n("line",function(){u.uncheck(),s.uncheck(),h.uncheck(),v.uncheck(),d.check(),t(),l()});d.addClass(c+"-lineButton");var s=n("ellipse",function(){u.uncheck(),d.uncheck(),h.uncheck(),v.uncheck(),s.check(),o(),l()});s.addClass(c+"-ellipseButton");var h=n("rectangle",function(){u.uncheck(),d.uncheck(),s.uncheck(),v.uncheck(),h.check(),a(),l()});h.addClass(c+"-rectangleButton");var v=n("bucket",function(){u.uncheck(),d.uncheck(),s.uncheck(),h.uncheck(),v.check(),i(),l()});v.addClass(c+"-bucketButton");var f=r(c+"-content");f.appendChild(u.element),f.appendChild(d.element),f.appendChild(s.element),f.appendChild(h.element),f.appendChild(v.element);var m=r(c);m.appendChild(f);var p=f.classList,g=!1;return{element:m,hide:l,isVisible:function(){return g},show:function(){p.add("visible"),g=!0}}}function P(e){function n(){function n(){removeEventListener("mouseup",t),removeEventListener("touchend",o),c.remove("active"),clearTimeout(a)}function t(){r?r=!1:n()}function o(e){r=!0;for(var t=e.changedTouches,o=0;o<t.length;o++)t[o].identifier===l&&(l=null,n())}function i(){a=setTimeout(i,e())}var r=!1;addEventListener("touchend",o),addEventListener("mouseup",t),c.add("active"),i()}var t=r("Button-content");t.style.backgroundImage="url(images/undo.svg)";var o=r("Button UndoButton disabled");o.appendChild(t),o.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),i?i=!1:n())}),o.addEventListener("touchstart",function(e){i=!0,null===l&&(e.preventDefault(),l=e.changedTouches[0].identifier,n())});var a,i=!1,l=null,c=o.classList;return{element:o,disable:function(){c.add("disabled")},enable:function(){c.remove("disabled")}}}!function(){var e=r("Main-horizontalProgress"),n=r("Main-verticalProgress"),t=r("Main-loadBar");t.appendChild(e),t.appendChild(n);var o=p(),a=document.body;a.appendChild(o.element),a.appendChild(t);var i=0,l=["bucket","burger","ellipse","eraser","line","palette","params","pencil","rectangle","undo"];l.forEach(function(r){var c=new Image;c.src="images/"+r+".svg",c.onload=c.onerror=c.onabort=function(){i++;var r=i/l.length*100+"%";e.style.width=r,n.style.height=r,i==l.length&&(o.show(),setTimeout(function(){t.classList.add("hidden"),setTimeout(function(){a.removeChild(t)},250)},250))}});var c=o.resize;addEventListener("resize",c),c()}()}();