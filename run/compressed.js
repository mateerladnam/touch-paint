!function(){function e(e,n){var t=o("Button-content");t.style.backgroundImage="url(images/"+e+".svg)";var a=o("Button");a.appendChild(t),a.addEventListener("touchstart",function(e){e.preventDefault(),n(),a.classList.add("active"),clearTimeout(i),i=setTimeout(function(){a.classList.remove("active")},100)});var i,l=!1;return{element:a,addClass:function(e){a.classList.add(e)},check:function(){a.classList.add("checked"),l=!0},isChecked:function(){return l},uncheck:function(){a.classList.remove("checked"),l=!1}}}function n(e,n){var t={},a=e/2,i=!1,o=n.canvas;o.addEventListener("touchstart",function(l){if(i){l.preventDefault();for(var r=o.getBoundingClientRect(),d=l.changedTouches,s=0;s<d.length;s++){var u=d[s],h=u.clientX-r.left,f=u.clientY-r.top;!function(e,t,a){n.operate(function(n){n.lineWidth=e,n.strokeStyle=n.fillStyle=t,n.beginPath(),n.arc(h,f,a,0,2*Math.PI),n.fill()})}(e,c,a),t[u.identifier]={x:h,y:f}}}}),o.addEventListener("touchmove",function(a){if(i){a.preventDefault();for(var l=o.getBoundingClientRect(),r=a.changedTouches,d=0;d<r.length;d++){var s=r[d],u=t[s.identifier];if(u){var h=s.clientX-l.left,f=s.clientY-l.top;!function(e,t,a,i){n.operate(function(n){n.lineWidth=e,n.strokeStyle=n.fillStyle=t,n.beginPath(),n.moveTo(a,i),n.lineTo(h,f),n.stroke()})}(e,c,u.x,u.y),u.x=h,u.y=f}}}}),o.addEventListener("touchend",function(e){e.preventDefault();for(var n=e.changedTouches,a=0;a<n.length;a++)delete t[n[a].identifier]});var l=0,r=0,d=0,c="hsl(0, 0%, 0%)";return{disable:function(){i=!1},enable:function(){i=!0},setColor:function(e,n,t){l=e,r=n,d=t,c="hsl("+l+", "+r+"%, "+d+"%)"},setSize:function(n){e=n,a=e/2}}}function t(){function e(){i.save(),i.fillStyle="#fff",i.fillRect(0,0,t,t),i.restore()}var n="Canvas",t=Math.max(screen.width,screen.height),a=document.createElement("canvas");a.className=n+"-canvas",a.width=a.height=t,a.style.left=a.style.top=-t/2+"px";var i=a.getContext("2d");i.lineCap="round";var l=o(n+"-center");l.appendChild(a);var r=document.createElement("canvas");r.width=r.height=t;var d=r.getContext("2d");d.fillStyle="#fff",d.fillRect(0,0,t,t);var c=o(n);c.appendChild(l),e();var s=[];return{canvas:a,clear:e,element:c,operate:function(e){s.push(e),e(i),s.length>1024&&s.shift()(d)},undo:function(){i.drawImage(r,0,0),s.length&&(s.pop(),s.forEach(function(e){e(i)}))}}}function a(e,n,t,a){function i(e,n,t){var a="hsl("+e+", "+n+"%, "+t+"%)";l.style.backgroundColor=a}var l=o("Button-content"),r=o("Button");r.appendChild(l),r.addEventListener("touchstart",function(e){e.preventDefault(),a(),r.classList.add("active"),clearTimeout(d),d=setTimeout(function(){r.classList.remove("active")},100)});var d,c=!1;return i(e,n,t),{element:r,setColor:i,addClass:function(e){r.classList.add(e)},check:function(){r.classList.add("checked"),c=!0},isChecked:function(){return c},uncheck:function(){r.classList.remove("checked"),c=!1}}}function i(e){function n(n,o,l){var r=a(n,o,l,function(){t.forEach(function(e){e.uncheck()}),r.check(),g=d,e(n,o,l)});r.addClass(i+"-colorButton"),t.push(r);var d={addClass:r.addClass,check:r.check,element:r.element,setColor:function(e,t,a){n=e,o=t,l=a,r.setColor(n,o,l)}};return d}var t=[],i="ColorButtonsPanel",l=n(0,0,0);l.addClass(i+"-blackButton"),l.check();var r=n(4,100,47);r.addClass(i+"-redButton");var d=n(115,87,50);d.addClass(i+"-greenButton");var c=n(232,100,50);c.addClass(i+"-blueButton");var s=n(0,0,53);s.addClass(i+"-greyButton");var u=n(30,100,33);u.addClass(i+"-brownButton");var h=n(114,100,33);h.addClass(i+"-darkGreenButton");var f=n(210,100,80);f.addClass(i+"-skyBlueButton");var v=n(60,100,50);v.addClass(i+"-yellowButton");var p=n(32,100,50);p.addClass(i+"-orangeButton");var m=n(306,100,33);m.addClass(i+"-violetButton");var C=n(312,100,83);C.addClass(i+"-pinkButton");var g=l,b=o(i);return b.appendChild(l.element),b.appendChild(s.element),b.appendChild(c.element),b.appendChild(f.element),b.appendChild(h.element),b.appendChild(d.element),b.appendChild(r.element),b.appendChild(v.element),b.appendChild(u.element),b.appendChild(p.element),b.appendChild(m.element),b.appendChild(C.element),{element:b,setColor:function(e,n,t){g.setColor(e,n,t)}}}function o(e){var n=document.createElement("div");return n.className=e,n}function l(e){function n(){e(t,a,i)}var t=0,a=0,i=0,l="EditColorPanel",r=s(function(e){t=e,n(),d.setHue(t),c.setHue(t)},n),d=m(function(e){a=e,n(),c.setSaturation(a)},n),c=u(function(e){i=e,n(),d.setLuminance(i)},n),h=o(l);return h.appendChild(r.element),h.appendChild(d.element),h.appendChild(c.element),{element:h,hide:function(){r.abortTouch(),d.abortTouch(),c.abortTouch(),h.classList.remove("visible")},setColor:function(e,n,o){t=e,a=n,i=o,r.setHue(t),d.setHue(t),d.setSaturation(a),d.setLuminance(i),c.setHue(t),c.setSaturation(a),c.setLuminance(i)},show:function(){h.classList.add("visible")}}}function r(e,n){var t="#fff",a={},i=e/2,o=!1,l=n.canvas;return l.addEventListener("touchstart",function(r){if(o){r.preventDefault();for(var d=l.getBoundingClientRect(),c=r.changedTouches,s=0;s<c.length;s++){var u=c[s],h=u.clientX-d.left,f=u.clientY-d.top;!function(e,a){n.operate(function(n){n.lineWidth=e,n.strokeStyle=n.fillStyle=t,n.beginPath(),n.arc(h,f,a,0,2*Math.PI),n.fill()})}(e,i),a[u.identifier]={x:h,y:f}}}}),l.addEventListener("touchmove",function(i){if(o){i.preventDefault();for(var r=l.getBoundingClientRect(),d=i.changedTouches,c=0;c<d.length;c++){var s=d[c],u=a[s.identifier];if(u){var h=s.clientX-r.left,f=s.clientY-r.top;!function(e,a,i){n.operate(function(n){n.lineWidth=e,n.strokeStyle=n.fillStyle=t,n.beginPath(),n.moveTo(a,i),n.lineTo(h,f),n.stroke()})}(e,u.x,u.y),u.x=h,u.y=f}}}}),l.addEventListener("touchend",function(e){e.preventDefault();for(var n=e.changedTouches,t=0;t<n.length;t++)delete a[n[t].identifier]}),{disable:function(){o=!1},enable:function(){o=!0},setSize:function(n){e=n,i=e/2,o&&enable()}}}function d(e,n){function t(){var e=document.createElement("input");e.type="file",e.accept="image/*",e.className="FileButton-input",e.addEventListener("change",function(){var a=new FileReader;a.readAsDataURL(e.files[0]),a.onload=function(){var e=new Image;e.src=a.result,e.onload=function(){n(e)},e.onabort=function(){},e.onerror=function(){}},a.onabort=function(){},a.onerror=function(){},i.removeChild(e),t()}),i.appendChild(e)}var a=o("Button-content");a.style.backgroundImage="url(images/"+e+".svg)";var i=o("Button");return i.appendChild(a),t(),{element:i,addClass:function(e){i.classList.add(e)}}}function c(n,t,a){var i="FilePanel",l=e("file",n);l.addClass(i+"-newButton");var r=d("open",t);r.addClass(i+"-openButton");var c=e("save",a);c.addClass(i+"-saveButton");var s=o(i+"-content");s.appendChild(l.element),s.appendChild(r.element),s.appendChild(c.element);var u=o(i);return u.appendChild(s),{element:u,hide:function(){s.classList.remove("visible")},show:function(){s.classList.add("visible")}}}function s(e,n){var t=C(0,function(n){e(360*n)},n);return t.addClass("HueSlider"),{abortTouch:t.abortTouch,element:t.element,setHue:function(e){t.setRatio(e/360)}}}function u(e,n){function t(){var e="hsl("+a+", "+i+"%, 0%)",n="hsl("+a+", "+i+"%, 50%)",t="hsl("+a+", "+i+"%, 100%)",o="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+o+"), linear-gradient(90deg, "+e+", "+n+", "+t+")",d.style.backgroundImage="linear-gradient(90deg, "+o+"), linear-gradient("+t+", "+n+", "+e+")"}var a=0,i=0,l="LuminanceSlider",r=o(l+"-portraitBar"),d=o(l+"-landscapeBar"),c=C(0,function(n){e(100*n)},n);return c.addClass(l),c.barElement.appendChild(r),c.barElement.appendChild(d),t(),{abortTouch:c.abortTouch,element:c.element,setHue:function(e){a=e,t()},setLuminance:function(e){c.setRatio(e/100)},setSaturation:function(e){i=e,t()}}}function h(){function a(){i(),l(),d(),u(),h(),B=a}function i(){T.hide(),P.uncheck()}function l(){w.hide(),R.uncheck()}function d(){S.hide(),x.uncheck()}function s(){I.uncheck(),y.disable()}function u(){D.uncheck(),E.disable()}function h(){I.check(),y.enable()}function m(){D.check(),E.enable()}function C(){i(),l(),d(),s(),m(),B=C}var b=4,k="MainPanel",L=t(),B=a,y=n(b,L);y.enable();var E=r(b,L),T=f(y.setColor,function(){i(),d(),h()}),w=v(b,function(e){y.setSize(e),E.setSize(e)},function(){B()}),S=c(function(){L.clear(),B()},function(e){L.operate(function(n){var t=n.canvas.width,a=(t-e.width)/2,i=(t-e.height)/2;n.drawImage(e,a,i)}),B()},function(){var e=L.element.offsetWidth,n=L.element.offsetHeight;p(L.canvas,e,n),B()}),I=e("pencil",a);I.addClass(k+"-brushButton"),I.check();var D=e("eraser",C);D.addClass(k+"-eraserButton");var P=e("palette",function(){P.isChecked()?B():(l(),d(),s(),u(),T.show(),P.check())});P.addClass(k+"-paletteButton");var R=e("params",function(){R.isChecked()?B():(i(),d(),s(),u(),w.show(),R.check())});R.addClass(k+"-paramsButton");var H=g(L.undo),x=e("burger",function(){x.isChecked()?B():(i(),l(),s(),u(),S.show(),x.check())});x.addClass(k+"-fileButton");var W=o(k+"-content");W.appendChild(L.element),W.appendChild(T.element),W.appendChild(w.element),W.appendChild(S.element);var M=o(k+"-bar");M.appendChild(I.element),M.appendChild(D.element),M.appendChild(P.element),M.appendChild(R.element),M.appendChild(H.element),M.appendChild(x.element);var X=o(k);return X.appendChild(W),X.appendChild(M),{element:X}}function f(e,n){function t(){s.hide(),c.uncheck()}var r="PalettePanel",d=i(function(t,a,i){c.setColor(t,a,i),s.setColor(t,a,i),e(t,a,i),c.isChecked()||n()}),c=a(0,0,0,function(){c.isChecked()?t():(s.show(),c.check())});c.addClass(r+"-previewButton");var s=l(function(n,t,a){c.setColor(n,t,a),d.setColor(n,t,a),e(n,t,a)}),u=o(r+"-secondLayer");u.appendChild(d.element),u.appendChild(c.element);var h=o(r+"-content");h.appendChild(s.element),h.appendChild(u);var f=o(r);return f.appendChild(h),{element:f,hide:function(){t(),h.classList.remove("visible")},show:function(){h.classList.add("visible")}}}function v(e,n,t){var a="ParamsPanel",i=1,l=24,r=(e-i)/(l-i),d=C(r,function(e){n(i+e*l)},t);d.addClass(a+"-slider");var c=o(a+"-content");c.appendChild(d.element);var s=o(a);return s.appendChild(c),{element:s,hide:function(){d.abortTouch(),c.classList.remove("visible")},show:function(){c.classList.add("visible")}}}function p(e,n,t){var a=document.createElement("canvas");a.width=n,a.height=t;var i=(n-e.width)/2,o=(t-e.height)/2,l=a.getContext("2d");l.drawImage(e,i,o);var r=document.createElement("a");r.href=a.toDataURL("image/png"),r.download="picture.png",r.style.position="absolute",r.style.top=r.style.left=0,document.body.appendChild(r),r.click(),document.body.removeChild(r)}function m(e,n){function t(){var e="hsl("+a+", 100%, "+i+"%)",n="hsl("+a+", 0%, "+i+"%)",t="rgba(0, 0, 0, 0.1), rgba(255, 255, 255, 0.1)";r.style.backgroundImage="linear-gradient("+t+"), linear-gradient(90deg, "+n+", "+e+")",d.style.backgroundImage="linear-gradient(90deg, "+t+"), linear-gradient("+e+", "+n+")"}var a=0,i=0,l="SaturationSlider",r=o(l+"-portraitBar"),d=o(l+"-landscapeBar"),c=C(0,function(n){e(100*n)},n);return c.addClass(l),c.barElement.appendChild(r),c.barElement.appendChild(d),t(),{abortTouch:c.abortTouch,element:c.element,setHue:function(e){a=e,t()},setLuminance:function(e){i=e,t()},setSaturation:function(e){c.setRatio(e/100)}}}function C(e,n,t){function a(t){var a=h.getBoundingClientRect(),i=u.offsetHeight;if(innerWidth>innerHeight){var o=h.offsetHeight;e=1-(t.clientY-a.top-i/2)/o}else{var l=h.offsetWidth;e=(t.clientX-a.left-i/2)/l}e=Math.max(0,Math.min(1,e)),d(),n(e)}function i(){s=null,u.classList.remove("active"),removeEventListener("touchmove",r),removeEventListener("touchend",l)}function l(e){for(var n=e.changedTouches,a=0;a<n.length;a++)if(n[a].identifier===s){e.preventDefault(),i(),t();break}}function r(e){for(var n=e.changedTouches,t=0;t<n.length;t++){var i=n[t];if(i.identifier===s){e.preventDefault(),a(i);break}}}function d(){u.style.top=100*(1-e)+"%",u.style.left=100*e+"%"}var c="Slider",s=null,u=o(c+"-handle"),h=o(c+"-handleWrapper");h.appendChild(u);var f=o(c+"-bar"),v=o(c);return v.appendChild(f),v.appendChild(h),v.addEventListener("touchstart",function(e){if(null===s){e.preventDefault();var n=e.changedTouches[0];s=n.identifier,u.classList.add("active"),a(n),addEventListener("touchmove",r),addEventListener("touchend",l)}}),d(),{barElement:f,element:v,abortTouch:function(){null!==s&&i()},addClass:function(e){v.classList.add(e)},setRatio:function(n){e=n,d()}}}function g(e){var n=o("Button-content");n.style.backgroundImage="url(images/undo.svg)";var t=o("Button UndoButton");t.appendChild(n),t.addEventListener("touchstart",function(n){function o(e){for(var n=e.changedTouches,l=0;l<n.length;l++)n[l].identifier===i&&(i=null,t.classList.remove("active"),removeEventListener("touchend",o),clearInterval(a))}null===i&&(n.preventDefault(),i=n.changedTouches[0].identifier,t.classList.add("active"),addEventListener("touchend",o),a=setInterval(e,60),e())});var a,i=null;return{element:t}}!function(){var e=h();document.body.appendChild(e.element)}()}();